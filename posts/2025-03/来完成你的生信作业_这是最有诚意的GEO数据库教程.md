---
title: "来完成你的生信作业，这是最有诚意的GEO数据库教程"
date: 2025-03-14T04:34:40Z
draft: ["false"]
tags: [
  "果子学生信",
  "fetched"
]
categories: ["Duty"]
---
来完成你的生信作业，这是最有诚意的GEO数据库教程 by 果子学生信
------
<div><section><p>上次更新了一个GEO数据框的帖子，包含了GEO分析的主要组成部分，其中有些区域为了代码复用，不是很容易懂。现在对其进行注释，并增加KEGG分析的内容，力求能让他变成<strong>最有诚意的GEO数据分析教程</strong>，文末还录制了一个友好的导学视频，希望物尽其用。</p><h3><span>以下是正文：</span></h3><p>GEO数据库包罗万象，对于每个领域的科研工作者很有帮助。<br>我最开始分析GEO芯片主要使用别人的代码，跑流程。但是绝对不能出现报错，一报错就束手无策。</p><p>遇到比较困难的地方就使用别人的小工具来代替。比如，ID转换，GO分析等。直到去年我才能够完全使用R语言实现。</p><p>这两年，网上的教程帖子井喷一样涌现，<strong>大有教师超过学员的趋势</strong>。</p><p>但是，GEO的分析跟TCGA不一样，里面要考虑的细节比较多。<br>比如我们今天要解决以下几个问题：</p><blockquote><ol><li><p><span>GEO数据如何方便地下载？</span></p></li><li><p><span>数据什么时候需要标准化？</span></p></li><li><p><span>什么时候做log转换？</span></p></li><li><p><span>芯片探针如何转换？</span></p></li><li><p><span>差异基因如何获得？</span></p></li><li><p><span>配对样本的对比矩阵如何构建？</span></p></li><li><p><span>配对样本如何作图展示？</span></p></li><li><p><span>热图火山图究竟在什么？</span></p></li><li><p><span>GO分析，KEGG分析怎么做，如何解释？</span></p></li></ol></blockquote><p>看文献得到GSE号，这是数据的名片，<strong>GSE32575</strong>，<br></p><figure><img data-ratio="0.28225806451612906" data-src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX2qeiaDCtLUUzWvALIqqQSEXvvmO0G7RsBF32hPr2bNZFxVzIs4lHwgnSfYwpBxyVq4qHjhvHWOD0w/640?wx_fmt=png" data-type="png" data-w="1240" title="文献中提及的GSE号" src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX2qeiaDCtLUUzWvALIqqQSEXvvmO0G7RsBF32hPr2bNZFxVzIs4lHwgnSfYwpBxyVq4qHjhvHWOD0w/640?wx_fmt=png"><figcaption>文献中提及的GSE号</figcaption></figure><p>在这个网址输入这个号我们可以知道这个芯片的信息<br>https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi<br></p><figure><img data-ratio="0.4280821917808219" data-src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX2qeiaDCtLUUzWvALIqqQSEXUc55caBKZgL6TGumH1OicuyH1psSsOvDicCe8Pmbe6eL7R8b9L0ZIs7g/640?wx_fmt=png" data-type="png" data-w="1168" title="GEO官网" src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX2qeiaDCtLUUzWvALIqqQSEXUc55caBKZgL6TGumH1OicuyH1psSsOvDicCe8Pmbe6eL7R8b9L0ZIs7g/640?wx_fmt=png"><figcaption>GEO官网</figcaption></figure><p>点击进去后，会有这个芯片的介绍<br>比如，这个芯片一开始出现的时候是干什么的？<br></p><figure><img data-ratio="0.6934984520123839" data-src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX2qeiaDCtLUUzWvALIqqQSEX8ZogBhIV6ibCnpEx3uhxcYWbgxvXzdNIAgEIakFofyNedwiaCp2QWqWA/640?wx_fmt=png" data-type="png" data-w="969" title="summary" src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX2qeiaDCtLUUzWvALIqqQSEX8ZogBhIV6ibCnpEx3uhxcYWbgxvXzdNIAgEIakFofyNedwiaCp2QWqWA/640?wx_fmt=png"><figcaption>summary</figcaption></figure><br>认真读一读就知道作者为什么要做这个芯片。<br>如果还不是很清楚，可以往下看，可以看到实验设计，甚至还有这个芯片当时发表的文章。下载下来读一读，可以看看当时这个芯片的哪些信息被使用了，还有哪些没被使用，我们可以提出新的科研假设，用别人的信息去支持。而这也是芯片数据挖掘的目的：<blockquote><p>用别人的数据支持自己的科研假设。</p></blockquote><p>在往下看还有平台信息GPL6102，这个信息可以帮助我们来注释文件。<br></p><figure><img data-ratio="0.4787123572170301" data-src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX2qeiaDCtLUUzWvALIqqQSEXYBuPr8VgobaHuBtTVsP2j88iaQdnDTWc4091o7yIy3JShhqkbtzvsww/640?wx_fmt=png" data-type="png" data-w="963" title="" src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX2qeiaDCtLUUzWvALIqqQSEXYBuPr8VgobaHuBtTVsP2j88iaQdnDTWc4091o7yIy3JShhqkbtzvsww/640?wx_fmt=png"></figure><br>图中的48表示这个芯片做了48个样本，每个样本都写明是什么样本。<br>假如点击<code>Analyze with GEO2R</code>按钮，就可以按照以下帖子介绍的方法，无代码分析这个芯片。<br><a href="https://mp.weixin.qq.com/s?__biz=MzIyMzA2MTcwMg==&amp;mid=2650732488&amp;idx=1&amp;sn=98d0bd601bb68acd77d4efd7dc8fa483&amp;chksm=f029a461c75e2d772b0f68c647e367c25e9bd88b2b20c2b0efa0d5ea3eeab750a7fc9df0a499&amp;mpshare=1&amp;scene=21&amp;srcid=0616nFPEpReQpvVBRZJmVBXb#wechat_redirect" data-linktype="2">无代码GEO芯片分析图文教程</a></section><section><span><br></span></section><section><span>但是今天，我们要用更加方便快捷的方法，假如你有一点耐心，完全可以复制这篇帖子的每一步操作，最后得到能发表的图片。</span><p>黑色区域是代码块，可以一整块一整块复制到Rstudio的脚本中，然后一行行运行，代码框中的#号表示注释，也就是这一行的内容不会被当成代码执行。</p><p>关于如何配置自己的R语言环境，可以看这篇帖子。<br><a href="https://mp.weixin.qq.com/s?__biz=MzIyMzA2MTcwMg==&amp;mid=2650733057&amp;idx=1&amp;sn=1c0fc3e3647f384448d09d1ece4a0862&amp;chksm=f029a9a8c75e20bed038b8a229c5e2360081a035764847b991a587915cc72468a2e8f3c01aee&amp;mpshare=1&amp;scene=21&amp;srcid=1206IyYu2494JCbToYj1HkeL#wechat_redirect" data-linktype="2">学习R语言，从这一课开始</a></p><p>捣鼓好了之后，我们就可以往下操作了，而当你完成这个帖子的那一刻，你也会一脚踏进数据挖掘的大门，至少说，见了世面，以后不会被别人那些云山雾罩的话给忽悠。</p><h3><span>1.加载R包获取数据。</span></h3><pre><code><span>## 加载R包</span><br>library(GEOquery)<br><span>## 下载数据，如果文件夹中有会直接读入</span><br>gset = getGEO('GSE32575', destdir=<span>"."</span>,getGPL = F)<br><span>## 获取ExpressionSet对象，包括的表达矩阵和分组信息</span><br>gset=gset[[1]]<br></code></pre><p>以后只要更改GSE号，就可以直接下载别的GEO数据，很方便。</p><h3><span>2.通过pData函数获取分组信息</span></h3><pre><code><span>## 获取分组信息,点开查阅信息</span><br>pdata=pData(gset)<br><span>## 只要后36个,本次选择的这36个是配对的。</span><br><span>## 所以，别人的芯片我们也不是全要，我们只要适合自己的数据</span><br>group_list=c(rep('before',18),rep('after',18))<br>group_list=factor(group_list)<br><span>## 强制限定顺序</span><br>group_list &lt;- relevel(group_list, ref=<span>"before"</span>)<br></code></pre><h3><span>3.通过exprs函数获取表达矩阵并校正</span></h3><pre><code><span>exprSet</span>=exprs(gset)<br></code></pre><p>可以先简单看一下整体样本的表达情况，其中<code>exprSet[,-c(1:12)]</code>的意思是去掉这个数据的前12个，因为我们需要的后面36个</p><pre><code>boxplot(exprSet[,-c(<span>1</span>:<span>12</span>)],outline=<span>FALSE</span>, notch=<span>T</span>,col=group_list, las=<span>2</span>)<br></code></pre><figure><img data-ratio="0.643908969210174" data-src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX2qeiaDCtLUUzWvALIqqQSEXvHpWdOtwdwIIkUTMGejv8undyeQQJ1frJT3wOvJQA4AYRiaxepQK13Q/640?wx_fmt=png" data-type="png" data-w="747" title="未校正前" src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX2qeiaDCtLUUzWvALIqqQSEXvHpWdOtwdwIIkUTMGejv8undyeQQJ1frJT3wOvJQA4AYRiaxepQK13Q/640?wx_fmt=png"><figcaption>未校正前</figcaption></figure><p>需要人工校正一下，用的方法类似于<a href="https://mp.weixin.qq.com/s?__biz=MzIyMzA2MTcwMg==&amp;mid=2650732860&amp;idx=2&amp;sn=03a2eccf7b872e4b68fb0dd5e9149de3&amp;chksm=f029aa95c75e2383b83c585e2296eb6d78f6dee1e28e0941abcc950ab95752c3d462acacf088&amp;mpshare=1&amp;scene=21&amp;srcid=1216CAiTHi5GZWpy040ZkueP#wechat_redirect" data-linktype="2">Quntile Normalization</a></p><p>这里我们用limma包内置的一个函数</p><pre><code><span>library</span>(limma) <br>exprSet=normalizeBetweenArrays(exprSet)<br>boxplot(exprSet,outline=<span>FALSE</span>, notch=<span>T</span>,col=group_list, las=<span>2</span>)<br></code></pre><figure><img data-ratio="0.6549391069012178" data-src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX2qeiaDCtLUUzWvALIqqQSEX9qX3JAwbbFlkpdBGgBbkoceVLxAfxJDR82ib2vdQXdKe50nz2lMPWKA/640?wx_fmt=png" data-type="png" data-w="739" title="校正后" src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX2qeiaDCtLUUzWvALIqqQSEX9qX3JAwbbFlkpdBGgBbkoceVLxAfxJDR82ib2vdQXdKe50nz2lMPWKA/640?wx_fmt=png"><figcaption>校正后</figcaption></figure><h3><span>4.判断是否需要进行数据转换</span></h3><p>我们通过分组信息已经知道，前12个样本本次不需要，所以先去掉</p><pre><code>exprSet = as.data.frame(exprSet)[,-se<span>q(1,12)</span>]<br></code></pre><p>打开现在的表达矩阵，是这个样子的<br></p><figure><img data-ratio="0.5962059620596206" data-src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX2qeiaDCtLUUzWvALIqqQSEX2D4GKia8AREGhGOzYQ5DTInbQ61mJ52Bhfvmiasfux4icC01yCCkKb1xg/640?wx_fmt=png" data-type="png" data-w="738" title="表达矩阵局部" src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX2qeiaDCtLUUzWvALIqqQSEX2D4GKia8AREGhGOzYQ5DTInbQ61mJ52Bhfvmiasfux4icC01yCCkKb1xg/640?wx_fmt=png"><figcaption>表达矩阵局部</figcaption></figure><br>肉眼看到数字很大，这时候需要log转换(选log2)。<br>此外还有一个脚本可以自动判断是否需要log转换，这个脚本来自于GEO2R，我改写了一点点。</section><section><br><pre><code>ex &lt;- exprSet<br><span>qx &lt;- as.numeric(quantile(ex, c(0., 0.25, 0.5, 0.75, 0.99, 1.0), na.rm=T))<br>LogC &lt;- (qx[5] &gt;</span> <span>100</span>) ||<br>  (<span>qx[6]</span>-<span>qx[1]</span> &gt; <span>50</span> &amp;&amp; <span>qx[2]</span> &gt; <span>0</span>) ||<br>  (<span>qx[2]</span> &gt; <span>0</span> &amp;&amp; <span>qx[2]</span> &lt; <span>1</span> &amp;&amp; <span>qx[4]</span> &gt; <span>1</span> &amp;&amp; <span>qx[4]</span> &lt; <span>2</span>)<br><br><span>if</span> (LogC) { ex[which(ex &lt;= <span>0</span>)] &lt;- NaN<br>exprSet &lt;- log2(ex)<br><span>print</span>(<span>"log2 transform finished"</span>)}<span>else</span>{<span>print</span>(<span>"log2 transform not needed"</span>)}<br></code></pre><p>这个语句会自动判断，如果已经log话就跳过，并提示</p><blockquote><p>"log2 transform not needed"</p></blockquote><p>如果没有log话，他自动log2，并且提示：</p><blockquote><p>"log2 transform finished"</p></blockquote><p>这时候再来看这个数据就规则多了<br></p><figure><img data-ratio="0.6453125" data-src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX2qeiaDCtLUUzWvALIqqQSEX3Q8z13p2LKCF4qBgY27OtGc1HlLlaBTHL3PricaFKELTpcx7CMSCic3g/640?wx_fmt=png" data-type="png" data-w="640" title="log2转换后" src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX2qeiaDCtLUUzWvALIqqQSEX3Q8z13p2LKCF4qBgY27OtGc1HlLlaBTHL3PricaFKELTpcx7CMSCic3g/640?wx_fmt=png"><figcaption>log2转换后</figcaption></figure><br>但是我们发现一个问题，这个表达数据行名是探针，不是我们熟悉的基因名称如果TP53，BRCA1这样的，所以我们需要注释他。<h3><span>5.获取注释信息</span></h3><p><strong>这步会很顺利，也会很难，是技术上的限速环节。</strong><br>通常情况下我们使用R包来注释，R包和平台的注释信息对应关系我整理了一个表格 platformMap，是一个文本文件，在文末有获取方法。</p><pre><code>platformMap &lt;- data.table::fread(<span>"platformMap.txt"</span>)<br></code></pre><p>我们根据上述帖子里面提到的platformMap，找到对应的R包是：</p><blockquote><p>"illuminaHumanv2.db"</p></blockquote><figure><img data-ratio="0.6484687083888149" data-src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX2qeiaDCtLUUzWvALIqqQSEXNvK54l80ZBsDqD70PCIM4ib2qiaOHoaFtDkCVstMnot58zFUtjJYToFw/640?wx_fmt=png" data-type="png" data-w="751" title="" src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX2qeiaDCtLUUzWvALIqqQSEXNvK54l80ZBsDqD70PCIM4ib2qiaOHoaFtDkCVstMnot58zFUtjJYToFw/640?wx_fmt=png"></figure><p>这里面的GPL6102是平台名称，我们在一开始已经在网页中知道了，如果忘记了，不要紧，这行代码可以自动获取</p><pre><code><span>index</span> = gset@annotation<br></code></pre><p>我们也发现，表格中对应的 "illuminaHumanv2"，跟我们需要的R包 "illuminaHumanv2.db"，中间相差个“.db”，如果是单个，就自己加上，我们也可以使用代码的方法，自动获取：</p><pre><code><span>index</span> = gset@annotation<br><span>platformDB</span> = paste0(platformMap<span>$bioc_package</span>[grep(index,platformMap<span>$gpl</span>)],<span>".db"</span>)<br></code></pre><p>安装R包并加载</p><pre><code><span>## 第一句是为了增加镜像</span><br><span>if</span>(length(getOption(<span>"BioC_mirror"</span>))==<span>0</span>) options(BioC_mirror=<span>"https://mirrors.ustc.edu.cn/bioc/"</span>)<br><span>## 没有这个包就给你装，有就不装</span><br><span>if</span>(!<span>require</span>(<span>"illuminaHumanv2.db"</span>)) BiocManager::install(<span>"illuminaHumanv2.db"</span>,update = <span>F</span>,ask = <span>F</span>)<br><span>## 加载R包 </span><br><span>library</span>(illuminaHumanv2.db)<br></code></pre><p>获取探针对应的symbol信息</p><pre><code><span>## 获取表达矩阵的行名，就是探针名称</span><br>probeset &lt;- rownames(exprSet)<br><span>## 使用lookup函数，找到探针在illuminaHumanv2.db中的对应基因名称</span><br><span>## 如果分析别的芯片数据，把illuminaHumanv2.db更换即可</span><br>SYMBOL &lt;-  annotate::lookUp(probeset,<span>"illuminaHumanv2.db"</span>, <span>"SYMBOL"</span>)<br><span>## 转换为向量</span><br>symbol = as.vector(unlist(SYMBOL))<br></code></pre><figure><img data-ratio="0.21571428571428572" data-src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX2qeiaDCtLUUzWvALIqqQSEXCM99wFfAj3xSsER3Vfnw8GB4kJu8ZWhm0fC1QoWq68MvjfwIm6VA7A/640?wx_fmt=png" data-type="png" data-w="700" title="" src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX2qeiaDCtLUUzWvALIqqQSEXCM99wFfAj3xSsER3Vfnw8GB4kJu8ZWhm0fC1QoWq68MvjfwIm6VA7A/640?wx_fmt=png"></figure><p>制作probe2symbol转换文件</p><pre><code><span>probe2symbol</span> = data.frame(probeset,symbol,stringsAsFactors = F)<br></code></pre><figure><img data-ratio="1.7738693467336684" data-src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX2qeiaDCtLUUzWvALIqqQSEXMIt6hyJmUGd509fd65mChN4j7ibBAc3N8vEZ7P7N6sT5mX9fbywxknQ/640?wx_fmt=png" data-type="png" data-w="199" title="probe2symbol部分结果" src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX2qeiaDCtLUUzWvALIqqQSEXMIt6hyJmUGd509fd65mChN4j7ibBAc3N8vEZ7P7N6sT5mX9fbywxknQ/640?wx_fmt=png"><figcaption>probe2symbol部分结果</figcaption></figure><br>有了这个文件，我们就可以进行探针转换了<br>有些平台是没有对应的R包的，可以自己下载平台信息来做<br><a href="https://mp.weixin.qq.com/s?__biz=MzIyMzA2MTcwMg==&amp;mid=2650732920&amp;idx=1&amp;sn=265f76c1d22240b55fc9b0bdfd74f3f1&amp;chksm=f029aad1c75e23c7abdc42734a2e78cbf83f11f89344db9c97aa922584cf5b37334b040b182a&amp;mpshare=1&amp;scene=21&amp;srcid=10216wSGYaiGZxj43xR2AEgk#wechat_redirect" data-linktype="2">skr！GEO芯片数据的探针ID转换</a><br><a href="https://mp.weixin.qq.com/s?__biz=MzIyMzA2MTcwMg==&amp;mid=2650733170&amp;idx=1&amp;sn=a77a6265f16f97b45e224f39063be5ae&amp;chksm=f029a9dbc75e20cdcdf01a78c74106a9106db5c0b4fa90ef28fd412dd166dc7a3eda32741e49&amp;mpshare=1&amp;scene=21&amp;srcid=1211T1hjuXGd8Ung4xizyG2g#wechat_redirect" data-linktype="2">有些GEO平台的探针转换比较麻烦</a><br><a href="https://mp.weixin.qq.com/s?__biz=MzIyMzA2MTcwMg==&amp;mid=2650733175&amp;idx=1&amp;sn=261b449a098bc85f0753ab8c7eb2a9b4&amp;chksm=f029a9dec75e20c82e6203829dbf78136285b05fa071f47f4b41f5f2f28f5a1d77a0a7f8f8f6&amp;mpshare=1&amp;scene=21&amp;srcid=12163UvhF6uFKyVMJN7IY75c#wechat_redirect" data-linktype="2">正则表达式是我们认识世界的哲学</a><h3><span>6.探针转换与基因去重</span></h3><p>一个基因会对应对个探针，有些基因名称会是重复的，这些都需要处理。<br>对于，多个探针，我们选取在样本中平均表达量最高的探针作为对应基因的表达量。一下代码完成所有事情，而且可以复用。</p><pre><code>library(dplyr)<br>library(tibble)<br>exprSet &lt;- exprSet %&gt;% <br>  rownames_to_column(<span>var</span>=<span>"probeset"</span>) %&gt;% <br>  <span>#合并探针的信息</span><br>  inner_join(probe2symbol,<span>by</span>=<span>"probeset"</span>) %&gt;% <br>  <span>#去掉多余信息</span><br>  <span>select</span>(-probeset) %&gt;% <br>  <span>#重新排列</span><br>  <span>select</span>(symbol,everything()) %&gt;% <br>  <span>#求出平均数(这边的点号代表上一步产出的数据)</span><br>  mutate(rowMean =rowMeans(.[grep(<span>"GSM"</span>, names(.))])) %&gt;% <br>  <span>#去除symbol中的NA</span><br>  filter(symbol != <span>"NA"</span>) %&gt;% <br>  <span>#把表达量的平均值按从大到小排序</span><br>  arrange(desc(rowMean)) %&gt;% <br>  <span># symbol留下第一个</span><br>  distinct(symbol,.keep_all = T) %&gt;% <br>  <span>#反向选择去除rowMean这一列</span><br>  <span>select</span>(-rowMean) %&gt;% <br>  <span># 列名变成行名</span><br>  column_to_rownames(<span>var</span> = <span>"symbol"</span>)<br></code></pre><p>现在数据变成这个样子<br></p><figure><img data-ratio="0.6167192429022083" data-src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX2qeiaDCtLUUzWvALIqqQSEXbAgBwbklib5qOpQBacicH0vDGTYvn55LQkR5rmGWZHoCENbUpJFMUZMQ/640?wx_fmt=png" data-type="png" data-w="634" title="探针去重与转换" src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX2qeiaDCtLUUzWvALIqqQSEXbAgBwbklib5qOpQBacicH0vDGTYvn55LQkR5rmGWZHoCENbUpJFMUZMQ/640?wx_fmt=png"><figcaption>探针去重与转换</figcaption></figure><br>而且，行数从原来的48701变成18962行。<h3><span>7.差异分析</span></h3><p>这里是limma包的核心环节，也是理解以后其他差异分析工具如Deseq2的基础。<br><a href="https://mp.weixin.qq.com/s?__biz=MzIyMzA2MTcwMg==&amp;mid=2650732891&amp;idx=4&amp;sn=1615f636c57a3a122080871abe5ae4eb&amp;chksm=f029aaf2c75e23e4b7931d8bf4ee60b8a119908ee1a54a44b16c4d349f0899c0618122bc8f5a&amp;mpshare=1&amp;scene=21&amp;srcid=1216BKTp6xB1HedZ011S2e1n#wechat_redirect" data-linktype="2">差异分析的矩阵构建有两种方式</a></p><p>我们选取格式比较简单的。如果没有配对信息，差异分析这样做：</p><pre><code><span>design</span>=model.matrix(~ group_list)<br><span>fit</span>=lmFit(exprSet,design)<br><span>fit</span>=eBa<span>yes</span>(fit) <br><span>allDiff</span>=topTable(fit,adjust=<span>'fdr'</span>,coef=<span>"group_listafter"</span>,number=Inf,p.value=<span>0.05</span>) <br></code></pre><p>其中allDiff得到6799行。<br>因为我们这里实际上是有配对信息的，差异分析应该这样做：</p><pre><code><span>pairinfo</span> = factor(rep(<span>1</span>:<span>18</span>,<span>2</span>))<br><span>design</span>=model.matrix(~ pairinfo+group_list)<br><span>fit</span>=lmFit(exprSet,design)<br><span>fit</span>=eBa<span>yes</span>(fit) <br><span>allDiff_pair</span>=topTable(fit,adjust=<span>'BH'</span>,coef=<span>"group_listafter"</span>,number=Inf,p.value=<span>0.05</span>)<br></code></pre><p>得到的差异分析结果allDiff_pair有7650个，比直接做差异分析要多接近1000个。<br></p><figure><img data-ratio="0.8227848101265823" data-src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX2qeiaDCtLUUzWvALIqqQSEXo87joGyjDex5BRPwFetHqerFsrA7WApKxzUerpP4YfIh3ibNiacuESRg/640?wx_fmt=png" data-type="png" data-w="474" title="" src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX2qeiaDCtLUUzWvALIqqQSEXo87joGyjDex5BRPwFetHqerFsrA7WApKxzUerpP4YfIh3ibNiacuESRg/640?wx_fmt=png"></figure><p>这里配对和非配对的差异分析，只相差一步，也就是是否有配对信息<br></p><figure><img data-ratio="0.28291814946619215" data-src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX2qeiaDCtLUUzWvALIqqQSEXfJVmETE1HIZBrBsXn1zSrron2vdDmLHzUbl40G1pH1J0ClMr4QrO1A/640?wx_fmt=png" data-type="png" data-w="1124" title="配对和非配对比较" src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX2qeiaDCtLUUzWvALIqqQSEXfJVmETE1HIZBrBsXn1zSrron2vdDmLHzUbl40G1pH1J0ClMr4QrO1A/640?wx_fmt=png"><figcaption>配对和非配对比较</figcaption></figure><h3><span>8.作图验证(非必要)</span></h3><p>差异分析的结果，配对和非配对理解起来比较抽象，我们用图片直观地感受一下。<br>首先我们需要得到ggplot2喜欢的数据格式，<strong>行是观测，列是变量</strong>，这也叫clean data，tide data, 清洁数据。而我们学习R语言的过程中，大部分时间都是在调整格式，这也是线下课上特别强调的一点。</p><p>首先基因名称需要在列，所以需要用t函数，行列转置。</p><pre><code>data_plot = as.data.frame(t(exprSet))<br>data_plot = data.frame(pairinfo=rep(1:18,2),<br>                       group=group_list,<br>                       data_plot,stringsAsFactors = F)<br></code></pre><figure><img data-ratio="0.6021341463414634" data-src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX2qeiaDCtLUUzWvALIqqQSEXKOt4J6ricvobGZiasiaiampFzAPKhrqm1gb6icicEJNknXjh3Sq6iaE5SegKQ/640?wx_fmt=png" data-type="png" data-w="656" title="data_plot局部" src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX2qeiaDCtLUUzWvALIqqQSEXKOt4J6ricvobGZiasiaiampFzAPKhrqm1gb6icicEJNknXjh3Sq6iaE5SegKQ/640?wx_fmt=png"><figcaption>data_plot局部</figcaption></figure><p>作图展示:<br>挑选了一个基因CAMKK2</p><pre><code>library(ggplot2)<br>ggplot(data_plot, aes(<span>group</span>,CAMKK2,fill=<span>group</span>)) +<br>  geom_jitter(aes(colour=<span>group</span>), size=<span>2</span>, alpha=<span>0.5</span>)+<br>  xlab(<span>""</span>) +<br>  ylab(paste(<span>"Expression of "</span>,<span>"CAMKK2"</span>))+<br>  theme_classic()+<br>  theme(legend.position = <span>"none"</span>)<br></code></pre><figure><img data-ratio="0.8164852255054432" data-src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX2qeiaDCtLUUzWvALIqqQSEXl93rhZI6vsp59DibE0kIEZYz3tyeVY8XgtKWYjIDuARK3jwXt1EcsaA/640?wx_fmt=png" data-type="png" data-w="643" title="无配对信息" src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX2qeiaDCtLUUzWvALIqqQSEXl93rhZI6vsp59DibE0kIEZYz3tyeVY8XgtKWYjIDuARK3jwXt1EcsaA/640?wx_fmt=png"><figcaption>无配对信息</figcaption></figure><p>看起来杂乱一片，根本得不到有用信息，我们加入他的配对信息，再来作图：</p><pre><code>library(ggplot2)<br>ggplot(data_plot, aes(<span>group</span>,CAMKK2,fill=<span>group</span>)) +<br>  geom_boxplot() +<br>  geom_point(size=<span>2</span>, alpha=<span>0.5</span>) +<br>  geom_line(aes(<span>group</span>=pairinfo), colour=<span>"black"</span>, linetype=<span>"11"</span>) +<br>  xlab(<span>""</span>) +<br>  ylab(paste(<span>"Expression of "</span>,<span>"CAMKK2"</span>))+<br>  theme_classic()+<br>  theme(legend.position = <span>"none"</span>)<br></code></pre><figure><img data-ratio="0.8052550231839258" data-src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX2qeiaDCtLUUzWvALIqqQSEX97h3iaiaNAJs6clFDdpxC9HFqCPTQ0JKvphDUNgud7rzJ3HLOCOosSTA/640?wx_fmt=png" data-type="png" data-w="647" title="加入配对信息" src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX2qeiaDCtLUUzWvALIqqQSEX97h3iaiaNAJs6clFDdpxC9HFqCPTQ0JKvphDUNgud7rzJ3HLOCOosSTA/640?wx_fmt=png"><figcaption>加入配对信息</figcaption></figure><p>突然间飞到枝头变凤凰。<strong>而这些基因就是普通差异分析会遗漏的部分，配对差异分析的时候他们又变得有意义</strong>。</p><p>再来看看真正有差异的基因吧，比如：</p><pre><code>library(ggplot2)<br>ggplot(data_plot, aes(<span>group</span>,CH25H,fill=<span>group</span>)) +<br>  geom_boxplot() +<br>  geom_point(size=<span>2</span>, alpha=<span>0.5</span>) +<br>  geom_line(aes(<span>group</span>=pairinfo), colour=<span>"black"</span>, linetype=<span>"11"</span>) +<br>  xlab(<span>""</span>) +<br>  ylab(paste(<span>"Expression of "</span>,<span>"CH25H"</span>))+<br>  theme_classic()+<br>  theme(legend.position = <span>"none"</span>)<br></code></pre><figure><img data-ratio="0.8080495356037152" data-src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX2qeiaDCtLUUzWvALIqqQSEXJn0MpfkfqdAO5OJlPur4okiaKmibpDfuPxakvG7y0Ir6mmqEYVx7sTWA/640?wx_fmt=png" data-type="png" data-w="646" title="CH25H" src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX2qeiaDCtLUUzWvALIqqQSEXJn0MpfkfqdAO5OJlPur4okiaKmibpDfuPxakvG7y0Ir6mmqEYVx7sTWA/640?wx_fmt=png"><figcaption>CH25H</figcaption></figure><p>我们还可以批量地作图，这段不必要，可以自己一张张画，我只是展示一下如何批量画出差异最大的8个基因：</p><pre><code>library(dplyr)<br>library(tibble)<br>allDiff_arrange &lt;- allDiff_pair %&gt;% <br>  rownames_to_column(<span>var</span>=<span>"genesymbol"</span>) %&gt;% <br>  arrange(desc(abs(logFC)))<br>genes &lt;- allDiff_arrange$genesymbol[<span>1</span>:<span>8</span>]<br><br>plotlist &lt;- lapply(genes, <span><span>function</span><span>(x)</span></span>{<br>  data =data.frame(data_plot[,c(<span>"pairinfo"</span>,<span>"group"</span>)],gene=data_plot[,x])<br>  ggplot(data, aes(group,gene,fill=group)) +<br>    geom_boxplot() +<br>    geom_point(size=<span>2</span>, alpha=<span>0.5</span>) +<br>    geom_line(aes(group=pairinfo), colour=<span>"black"</span>, linetype=<span>"11"</span>) +<br>    xlab(<span>""</span>) +<br>    ylab(paste(<span>"Expression of "</span>,x))+<br>    theme_classic()+<br>    theme(legend.position = <span>"none"</span>)<br>})<br><br>library(cowplot)<br>plot_grid(plotlist=plotlist, ncol=<span>4</span>,labels = LETTERS[<span>1</span>:<span>8</span>])<br></code></pre><figure><img data-ratio="0.6190476190476191" data-src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX2qeiaDCtLUUzWvALIqqQSEXMFDXBcStibTEgzVxMuZuBTGYUcrXQLr85TFLrmBFs3pEgWd7zlic5JFA/640?wx_fmt=png" data-type="png" data-w="840" title="差异最大的前8个基因" src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX2qeiaDCtLUUzWvALIqqQSEXMFDXBcStibTEgzVxMuZuBTGYUcrXQLr85TFLrmBFs3pEgWd7zlic5JFA/640?wx_fmt=png"><figcaption>差异最大的前8个基因</figcaption></figure><p>而配对样本的展示，我们用TCGA的数据演示过很多次<br><a href="https://mp.weixin.qq.com/s?__biz=MzIyMzA2MTcwMg==&amp;mid=2650733030&amp;idx=1&amp;sn=d0e4607d8cc6e0e93022ea6a7ac5ad28&amp;chksm=f029aa4fc75e2359595acc1dcbf12e96b66b45480cf30a944f47d84f1615831df7d93cba81d6&amp;mpshare=1&amp;scene=21&amp;srcid=1216BpO9BTbR7iF7yuLzDBdf#wechat_redirect" data-linktype="2">找出TCGA中的配对样本并正确展示数据</a><br><a href="https://mp.weixin.qq.com/s?__biz=MzIyMzA2MTcwMg==&amp;mid=2650732983&amp;idx=1&amp;sn=e5b1e507fb322ce6ce0ac66ce63a1ff9&amp;chksm=f029aa1ec75e2308e08e9f6d4f222f6d09d2f590bc1458e4250204fd71a179a03f02c574db06&amp;mpshare=1&amp;scene=21&amp;srcid=1031TTsQaZuUGeWdBekWpGGS#wechat_redirect" data-linktype="2">配对样本数据如何计算及展示？</a></p><h3><span>9.后续分析</span></h3><p>差异分析后还有很多操作，<br><a href="https://mp.weixin.qq.com/s?__biz=MzIyMzA2MTcwMg==&amp;mid=2650732880&amp;idx=3&amp;sn=2e078eb386bb92dcfd4d9fcac5b3ddaa&amp;chksm=f029aaf9c75e23ef09f4a30631018e19ed413fe01e7212ddb2eb7064d7e21560fc1ea68e239d&amp;mpshare=1&amp;scene=21&amp;srcid=1216mdydGhHeDVfzWbvWCeez#wechat_redirect" data-linktype="2">画一张热图</a></p><pre><code><span>library</span>(pheatmap)<br><span>## 设定差异基因阈值，减少差异基因用于提取表达矩阵</span><br>allDiff_pair=topTable(fit,adjust=<span>'BH'</span>,coef=<span>"group_listafter"</span>,number=<span>Inf</span>,p.value=<span>0.05</span>,lfc =<span>0.5</span>) <br><span>##提前部分数据用作热图绘制</span><br>heatdata &lt;- exprSet[rownames(allDiff_pair),]<br><span>##制作一个分组信息用于注释</span><br>annotation_col &lt;- data.frame(group_list)<br>rownames(annotation_col) &lt;- colnames(heatdata)<br><br><span>#如果注释出界，可以通过调整格子比例和字体修正</span><br>pheatmap(heatdata, <span>#热图的数据</span><br>         cluster_rows = <span>TRUE</span>,<span>#行聚类</span><br>         cluster_cols = <span>TRUE</span>,<span>#列聚类，可以看出样本之间的区分度</span><br>         annotation_col =annotation_col, <span>#标注样本分类</span><br>         annotation_legend=<span>TRUE</span>, <span># 显示注释</span><br>         show_rownames = <span>F</span>,<span># 显示行名</span><br>         show_colnames = <span>F</span>,<span># 显示列名</span><br>         scale = <span>"row"</span>, <span>#以行来标准化，这个功能很不错</span><br>         color =colorRampPalette(c(<span>"blue"</span>, <span>"white"</span>,<span>"red"</span>))(<span>100</span>))<br></code></pre><figure><img data-ratio="0.835423197492163" data-src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX2qeiaDCtLUUzWvALIqqQSEXqV4ibvOGvEnnbjhJgVDHZltDpjJiaWxRFmdk2Gl6gk1DLjK1jJPJGHnQ/640?wx_fmt=png" data-type="png" data-w="638" title="热图" src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX2qeiaDCtLUUzWvALIqqQSEXqV4ibvOGvEnnbjhJgVDHZltDpjJiaWxRFmdk2Gl6gk1DLjK1jJPJGHnQ/640?wx_fmt=png"><figcaption>热图</figcaption></figure><p>画热图的意义在哪？<br>第一看样本质量：本来before和after两组应该完全分开的，但是热图里面after有两个样本跟bfefore分不开，要考虑是不是测量失误，还是本身样本就特殊<br></p><figure><img data-ratio="0.2417391304347826" data-src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX2qeiaDCtLUUzWvALIqqQSEXNictcXiaeNsbBwZFgsCpXbNTqPaRsIrzAibcumwQDXPpeYiazD8qibf21UA/640?wx_fmt=png" data-type="png" data-w="575" title="热图看聚类" src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX2qeiaDCtLUUzWvALIqqQSEXNictcXiaeNsbBwZFgsCpXbNTqPaRsIrzAibcumwQDXPpeYiazD8qibf21UA/640?wx_fmt=png"><figcaption>热图看聚类</figcaption></figure><br>第二看差异基因：差异基因提取出来的热图，就应当呈现横竖两条线，把表格分成四个象限，也就是差异基因有高有低，这才符合常识。<p><br></p><p>我们还可以<a href="https://mp.weixin.qq.com/s?__biz=MzIyMzA2MTcwMg==&amp;mid=2650732880&amp;idx=2&amp;sn=96d19446e8a41ad10cdbf7854d258ebb&amp;chksm=f029aaf9c75e23ef2b43fdcbc8e7152e2a34222b53ff5ee299f7f7d37582fa21db888c27c0ce&amp;mpshare=1&amp;scene=21&amp;srcid=1216Nn0LKizLUgyhcSqUrQh1#wechat_redirect" data-linktype="2">画一个火山图</a></p><pre><code><span>library(ggplot2)<br>library(ggrepel)<br>library(dplyr)<br>libr<br>data <span>&lt;<span>-</span> <span>topTable</span>(<span>fit</span>,<span>adjust</span>=<span>'BH'</span>,<span>coef</span>=<span>"group_listafter"</span>,<span>number</span>=<span>Inf)</span> <br><span>data</span>$<span>significant</span> &lt;<span>-</span> <span>as.factor</span>(<span>data</span>$<span>adj.P.Val</span>&lt;<span>0.05</span> &amp; <span>abs</span>(<span>data</span>$<span>logFC</span>) &gt;</span> 0.5)<br>data$gene <span>&lt;<span>-</span> <span>rownames</span>(<span>data</span>)<br><span>ggplot</span>(<span>data</span>=<span>data,</span> <span>aes</span>(<span>x</span>=<span>logFC,</span> <span>y</span> =<span>-log10(adj.P.Val),color</span>=<span>significant))</span> +<br>  <span>geom_point</span>(<span>alpha</span>=<span>0.8,</span> <span>size</span>=<span>1.2,col</span>=<span>"black"</span>)+<br>  <span>geom_point</span>(<span>data</span>=<span>subset(data,</span> <span>logFC</span> &gt;</span> 0.5),alpha=0.8, size=1.2,col="red")+<br>  geom_point(data=subset(data, logFC <span>&lt; <span>-0.5</span>),<span>alpha</span>=<span>0.6,</span> <span>size</span>=<span>1.2,col</span>=<span>"blue"</span>)+<br>  <span>labs</span>(<span>x</span>=<span>"log2 (fold change)"</span>,<span>y</span>=<span>"-log10 (adj.P.Val)"</span>)+<br>  <span>theme</span>(<span>plot.title</span> = <span>element_text(hjust</span> = <span>0.4))+</span><br>  <span>geom_hline</span>(<span>yintercept</span> = <span>-log10(0.05),lty</span>=<span>4,lwd</span>=<span>0.6,alpha</span>=<span>0.8)+</span><br>  <span>geom_vline</span>(<span>xintercept</span> = <span>c(0.5,-0.5),lty</span>=<span>4,lwd</span>=<span>0.6,alpha</span>=<span>0.8)+</span><br>  <span>theme_bw</span>()+<br>  <span>theme</span>(<span>panel.border</span> = <span>element_blank(),</span><br>        <span>panel.grid.major</span> = <span>element_blank(),</span> <br>        <span>panel.grid.minor</span> = <span>element_blank(),</span>   <br>        <span>axis.line</span> = <span>element_line(colour</span> = <span>"black"</span>)) +<br>  <span>geom_point</span>(<span>data</span>=<span>subset(data,</span> <span>abs</span>(<span>logFC</span>) &gt;</span> 1),alpha=0.8, size=3,col="green")+<br>  geom_text_repel(data=subset(data, abs(logFC) &gt; 1), <br>                  aes(label=gene),col="black",alpha = 0.8)<br></span></code></pre><figure><img data-ratio="0.747887323943662" data-src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX2qeiaDCtLUUzWvALIqqQSEXPKDibic8RSVNQYL8nqBZxhWZk1wjYFsMf16eVIfPufPiaSwoZWSUS6CRA/640?wx_fmt=png" data-type="png" data-w="710" title="定制火山图" src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX2qeiaDCtLUUzWvALIqqQSEXPKDibic8RSVNQYL8nqBZxhWZk1wjYFsMf16eVIfPufPiaSwoZWSUS6CRA/640?wx_fmt=png"><figcaption>定制火山图</figcaption></figure><p>火山图画起来简单，难的是如何定制化展示。比如在图上有不同的颜色，不同的点来表示数据。有什么意义呢？我其实理解的也不是很透彻，但是考虑到他的横坐标是变化倍数，纵坐标是p值的负数，那么p值越小，倍数越大的基因就会出现在左右上方。</p><p>数据是死的，而图形化展示是活的，火山图可能是大家觉得比较好的展示差异基因的方法。从这个图中我们还可以看出，两边是否对称，比如有的药物就是抑制基因转录的，那么加了药物的两组，可能会出现，上调和下调基因不对称的情形，这个从数据中可以分析出来，但是用图就一目了然了。</p><p>此外还有耳熟能详的GO分析，KEGG分析，我觉得都是名气很大用的很少的聚类方法。<br>做这个的意义在于，我们获得了几千个差异基因，但是我们确定最重要的基因呢？因人而异，不同的课题组，想的不一样。但是大体的思路是聚类，假如P53通路有100个基因，对于人类20000个基因而言，随便抓一把基因，出现P53通路基因的概率是100/20000,是0.005，现在3000个差异基因中就出现了50个P53通路的基因，这个概率是0.016，明显超过了他随机出现的概率，我们就可以说，p53通路被富集了，这个通路可能在你研究的课题中有重要作用。</p><p>Y叔的神包clusterprofiler可以做出特别好看的图。</p><p>比如GO分析，有三个组成部分，分别是CC，cellular compartment 细胞组分，BP，biological process，生物进程，MF，molecular function，分子功能。</p><pre><code><span>## 加载R包</span><br>suppressMessages(library(clusterProfiler))<br><span>#获得基因列表</span><br>gene &lt;- rownames(allDiff)<br><span>#基因名称转换，返回的是数据框</span><br>gene = bitr(gene, fromType=<span>"SYMBOL"</span>, toType=<span>"ENTREZID"</span>, OrgDb=<span>"org.Hs.eg.db"</span>)<br>de &lt;- gene$ENTREZID<br><span>## GO分析</span><br>go &lt;- enrichGO(gene = de, OrgDb = <span>"org.Hs.eg.db"</span>, ont=<span>"all"</span>)<br>library(ggplot2)<br>p &lt;- dotplot(go, split=<span>"ONTOLOGY"</span>) +facet_grid(ONTOLOGY~., scale=<span>"free"</span>)<br>p<br></code></pre><figure><img data-ratio="0.583904109589041" data-src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX2qeiaDCtLUUzWvALIqqQSEXNibAokASic9Xu6L3MeGc0SueHjSWXg5Gp4peSzv1s7kiccSkKG4hyQ0tw/640?wx_fmt=png" data-type="png" data-w="1168" title="GO分析" src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX2qeiaDCtLUUzWvALIqqQSEXNibAokASic9Xu6L3MeGc0SueHjSWXg5Gp4peSzv1s7kiccSkKG4hyQ0tw/640?wx_fmt=png"><figcaption>GO分析</figcaption></figure><p>如何看这个图，如何解释？看图容易解释难。简单说来，一看颜色，二看大小。颜色越红p值越小越可信，点越打表示富集的基因比例越多，越有可能被验证。</p><p>举个例子，BP那一项中，有个叫<strong>neutrophil mediate immunity</strong>的GO通路被富集了，看字面意思应该是中性粒细胞介导的免疫反应，联系到这到实验设计，就是一开始的summary和文章部分，我觉得这个是合理的，因为他研究的就是长期慢性炎症对肥胖的影响，这里我们发现，炎症导致的免疫反应可能可以解释这个事情。还有很多其他的GO通路，需要自己根据背景去解释。去发现线索。</p><p>还有一个是广为人知的KEGG通路富集分析，Y叔的神包依然可以胜任。</p><pre><code>EGG <span>&lt;<span>-</span> <span>enrichKEGG</span>(<span>gene</span>= <span>gene$ENTREZID,</span><br>                  <span>organism</span>     = <span>'hsa'</span>,<br>                  <span>pvalueCutoff</span> = <span>0.05)</span><br><span>dotplot</span>(<span>EGG</span>)<br></span></code></pre><figure><img data-ratio="1.0222882615156017" data-src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX2qeiaDCtLUUzWvALIqqQSEXW8hicY7qXLdicheswtmibRp1jibV8wJibPdlmzCpJILd8LlpTVRa84kIKmw/640?wx_fmt=png" data-type="png" data-w="673" title="KEGG分析" src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX2qeiaDCtLUUzWvALIqqQSEXW8hicY7qXLdicheswtmibRp1jibV8wJibPdlmzCpJILd8LlpTVRa84kIKmw/640?wx_fmt=png"><figcaption>KEGG分析</figcaption></figure><p>这一看，全是大咖类的通路，每一个都是身价百万，说明啥问题，这篇文章的实验设计能够从多个方面解释。细胞周期，免疫反应，凋亡，等等，假如是我们自己的结果，我们就需要用自己的背景去思考，这么多通路是并联的还是串联的，是以此发生的级联反应，还是单兵作战呢？我觉得大部分情况下，我们会尝试用一个通路去说明。这是需要背景知识的。</p><p>假如我们对凋亡感兴趣，我们还可以看看我们有多少基因被富集在了凋亡通路，Y叔的神包clusterprofiler也是可以做的。而且做的很云淡风轻。<br>首先我们把富集的结果变成数据框，便于自己查看。</p><pre><code><span>test</span> &lt;- data.frame(EGG)<br></code></pre><figure><img data-ratio="0.5359281437125748" data-src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX2qeiaDCtLUUzWvALIqqQSEXUEPJI7CoCMtrXXKHNBxZABTRBK82iaDIfB3USoBzAGWicosjK2Bwz8iag/640?wx_fmt=png" data-type="png" data-w="668" title="" src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX2qeiaDCtLUUzWvALIqqQSEXUEPJI7CoCMtrXXKHNBxZABTRBK82iaDIfB3USoBzAGWicosjK2Bwz8iag/640?wx_fmt=png"></figure><br>我们发现想看的凋亡通路牌号是，<strong>hsa04210</strong>，那我们就用下面的代码浏览一下，会跳出一个网页。<p><br></p><pre><code>browseKEGG(EGG, <span>'hsa04210'</span>)<br></code></pre><figure><img data-ratio="0.6258064516129033" data-src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX2qeiaDCtLUUzWvALIqqQSEXQDmRNQDxcOGQ2NC6t9TZzrgibRl2Oq59R9e3icUeG3Eg62AaeQUJ40OQ/640?wx_fmt=png" data-type="png" data-w="1240" title="apoptosis通路" src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX2qeiaDCtLUUzWvALIqqQSEXQDmRNQDxcOGQ2NC6t9TZzrgibRl2Oq59R9e3icUeG3Eg62AaeQUJ40OQ/640?wx_fmt=png"><figcaption>apoptosis通路</figcaption></figure><br>其中标红的就是富集到的通路。<p><br></p><p>那么这时候我们就会想，差异基因是有高有低的，而通路富集的时候缺失了这一个信息。一种解决方案是，分别用高表达和低表达基因去做这个分析。我觉得信息是冗余和偏误的，因为任何一个通路的激活，都是伴随着基因的高表达和低表达，本身这就是一个整体，没必要分开分析。</p><p>另外一种方法是，先总体分析，然后再标注出上调和下调的基因。那么Y叔的神包也可以做的。<br></p><figure><img data-ratio="0.6443548387096775" data-src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX2qeiaDCtLUUzWvALIqqQSEXa9gkUBnK5iaLX4VQYwVxtgxibZj4Lib01Kj0JrEsg7BdwMicTtDiar6anjw/640?wx_fmt=png" data-type="png" data-w="1240" title="" src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX2qeiaDCtLUUzWvALIqqQSEXa9gkUBnK5iaLX4VQYwVxtgxibZj4Lib01Kj0JrEsg7BdwMicTtDiar6anjw/640?wx_fmt=png"></figure><br>好像上了一点档次，留给大家自己去实现。<p><br></p><p>那么我们这个GEO的分析就讲完了。来看看我们获得了哪些图片呢？<br></p><figure><img data-ratio="1.0776397515527951" data-src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX2qeiaDCtLUUzWvALIqqQSEXPQGt8YmmpQQDju4LfxGdcKlSMSHxqsXHPDBh80npBibnx1YKIEvianXQ/640?wx_fmt=png" data-type="png" data-w="644" title="" src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX2qeiaDCtLUUzWvALIqqQSEXPQGt8YmmpQQDju4LfxGdcKlSMSHxqsXHPDBh80npBibnx1YKIEvianXQ/640?wx_fmt=png"></figure><figure><img data-ratio="1.1738382099827882" data-src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX2qeiaDCtLUUzWvALIqqQSEXjUmfC90FGBKgWV0BdbW8OaWmpCKXZV1eibpx9GgAb5M9CxhzUkojoHQ/640?wx_fmt=png" data-type="png" data-w="581" title="" src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX2qeiaDCtLUUzWvALIqqQSEXjUmfC90FGBKgWV0BdbW8OaWmpCKXZV1eibpx9GgAb5M9CxhzUkojoHQ/640?wx_fmt=png"></figure><br>只要是参加过线下课的同学，或者只要R语言基本能力过关的同学，轻而易举就能重复这个帖子的所有内容。<br>即使是零基础，安装这个帖子准备好工作环境，也能完成。<br><a href="https://mp.weixin.qq.com/s?__biz=MzIyMzA2MTcwMg==&amp;mid=2650733057&amp;idx=1&amp;sn=1c0fc3e3647f384448d09d1ece4a0862&amp;chksm=f029a9a8c75e20bed038b8a229c5e2360081a035764847b991a587915cc72468a2e8f3c01aee&amp;mpshare=1&amp;scene=21&amp;srcid=1206IyYu2494JCbToYj1HkeL#wechat_redirect" data-linktype="2">学习R语言，从这一课开始</a><p><br></p><h3><span>如果继续做GESA，基因富集分析</span></h3><p>也是可以的，我自己觉得这个分析不需要人为设定差异基因的阈值，比如我们认为大于2倍就叫差异基因，这是不科学的，GSEA分析更加靠谱，可以代替GO和KEGG分析。<br></p><figure><img data-ratio="0.4975806451612903" data-src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX2qeiaDCtLUUzWvALIqqQSEXEzXVHqqpuXoYVw1OR1BN34tqxictyZv8NL1k6CibFPoAwS5ERuLGxwqQ/640?wx_fmt=png" data-type="png" data-w="1240" title="GSEA汇总图" src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX2qeiaDCtLUUzWvALIqqQSEXEzXVHqqpuXoYVw1OR1BN34tqxictyZv8NL1k6CibFPoAwS5ERuLGxwqQ/640?wx_fmt=png"><figcaption>GSEA汇总图</figcaption></figure><br><figure><img data-ratio="0.3370967741935484" data-src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX2qeiaDCtLUUzWvALIqqQSEX7EtCdWZXA1kvbuhYUQ37u3eM5gINaacEwDtAx3gmNT0JRGnkrsf5sA/640?wx_fmt=png" data-type="png" data-w="1240" title="正向调控" src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX2qeiaDCtLUUzWvALIqqQSEX7EtCdWZXA1kvbuhYUQ37u3eM5gINaacEwDtAx3gmNT0JRGnkrsf5sA/640?wx_fmt=png"><figcaption>正向调控</figcaption></figure><br><figure><img data-ratio="0.33225806451612905" data-src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX2qeiaDCtLUUzWvALIqqQSEXZiaJCiaHmWJKBdOmlXwvjOjsTDUpWVd7l5O4WN4xRDoJsfk80Nn2HRWw/640?wx_fmt=png" data-type="png" data-w="1240" title="负向调控" src="https://mmbiz.qpic.cn/mmbiz_png/NDy5aEnReX2qeiaDCtLUUzWvALIqqQSEXZiaJCiaHmWJKBdOmlXwvjOjsTDUpWVd7l5O4WN4xRDoJsfk80Nn2HRWw/640?wx_fmt=png"><figcaption>负向调控</figcaption></figure><p>假如我们通过以上的方法最终锁定了一两个基因，那么我们还可以对这个基因进行批量的相关性分析。<br><a href="https://mp.weixin.qq.com/s?__biz=MzIyMzA2MTcwMg==&amp;mid=2650733008&amp;idx=1&amp;sn=b66e3fd527f99ddf19dcf6c2501e5be3&amp;chksm=f029aa79c75e236f8951b87e17a51dc6a7dfeb555b983d8dc6d5a8c756b3eacc21829f19dc86&amp;mpshare=1&amp;scene=21&amp;srcid=1021CPW6bjS2zwvHtgz0ykcq#wechat_redirect" data-linktype="2">单基因批量相关性分析的妙用</a></p><h3><span>那么现在的问题是，技术上实现了，理论上该如何整合。</span></h3><p>R语言充其量只是个工具，<strong>神器不神，主要看人</strong>。假如你现在已经读过很多文献，做过很多实验，R语言一定有用，因为你首先想的会是用R语言解决自己的科学问题。</p><p>假如你现在还没有怎么读过文献，先不要急着要学习R语言。经常有学生加我微信，上来就说我要学习生信，我一听心里都很慌张，因为我知道，就我掌握的东西离生信还离得远，我就是从科研人员的角度功利地去运用生信知识解决问题。所以学习生信之前，先冷静几天，不要拿自己的爱好跟别人的专业去比较。</p><p>不分类别地去多看10分左右的文献可能是更好的策略，再高分的就高屋建瓴谈哲学对初学者不友好，只能学其行不能学其神，低分的容易把初学者带入<strong>科研皮条客</strong>的大坑，10分左右的文献，起手不高，论证严谨，大部分情况下比许多导师还可靠(这里用词很谨慎)。</p><p>有时候我会偏执地认为，读文献是性价比最高的提升科学思维的方法，一个科研人员的水平高低可以简单地用文献阅读量来比较。然后在回过头来看看这个帖子<strong>凝练</strong>自己的科学问题。有了科学问题我们就有了灵魂，才知道如何在海量资源中筛选有用的数据。<br><a href="https://mp.weixin.qq.com/s?__biz=MzIyMzA2MTcwMg==&amp;mid=2650732330&amp;idx=1&amp;sn=35751c91d8cbd62cf988679701f9da8e&amp;chksm=f029a483c75e2d951591f06cfb923f8d92a5c30e2bb2e962f01a582aa159ad0a60520a208d9e&amp;mpshare=1&amp;scene=21&amp;srcid=1201aeqQJfsBSaN71KyB8Dh9#wechat_redirect" data-linktype="2">课题设计：收不完的病人查不完的房，临床医生如何快速地设计一个靠谱的课题？</a></p><p>下周，我会更新一个长长的TCGA的帖子，这样我的2018年就这么过去了。</p><blockquote><p>因为考虑到有些朋友是新手，所以我还录制了一个友好的导学视频，教大家如何把帖子里面的内容化为己有，连同R语言安装教程还有platformMap文件一起打包。有需要的朋友，加我微信guotosky，简单介绍一下自己，即可获取。</p></blockquote><p>不需要任何赞赏，如果觉得这个帖子好看，就在右下角点击好看，这是微信的新功能。<br>祝大家新年快乐。</p></section><p><br></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/kTFNOrLfwz1pND877V8F5A",target="_blank" rel="noopener noreferrer">原文链接</a>
