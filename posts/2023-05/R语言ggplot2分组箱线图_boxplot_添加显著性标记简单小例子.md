---
title: "R语言ggplot2分组箱线图(boxplot)添加显著性标记简单小例子"
date: 2023-05-18T03:17:19Z
draft: ["false"]
tags: [
  "fetched",
  "小明的数据分析笔记本"
]
categories: ["Duty"]
---
R语言ggplot2分组箱线图(boxplot)添加显著性标记简单小例子 by 小明的数据分析笔记本
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" data-mpa-powered-by="yiban.io"><h6 data-tool="mdnice编辑器"><span></span><span>部分示例数据如下</span><span></span></h6><figure data-tool="mdnice编辑器"><img data-ratio="2.658450704225352" data-src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk50nsarwTTH6rsLwNA5v4ekDkmtpncA13go83avHUia5acthxeKkAibGSkcDXg079YKgicDDEfiaHib7qw/640?wx_fmt=png" data-type="png" data-w="284" src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk50nsarwTTH6rsLwNA5v4ekDkmtpncA13go83avHUia5acthxeKkAibGSkcDXg079YKgicDDEfiaHib7qw/640?wx_fmt=png"><figcaption>image.png</figcaption></figure><ul data-tool="mdnice编辑器"><li><section>第一列是数值</section></li><li><section>第二列是处理一</section></li><li><section>第三列是处理二</section></li></ul><p data-tool="mdnice编辑器">最终出图如下</p><figure data-tool="mdnice编辑器"><img data-ratio="0.5032258064516129" data-src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk50nsarwTTH6rsLwNA5v4ekuu2xialy8Iqibqe2y5AlibPp045V74LUFuIy5iay8EdMmjxy9SHicMe1hHg/640?wx_fmt=png" data-type="png" data-w="1240" src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk50nsarwTTH6rsLwNA5v4ekuu2xialy8Iqibqe2y5AlibPp045V74LUFuIy5iay8EdMmjxy9SHicMe1hHg/640?wx_fmt=png"><figcaption>image.png</figcaption></figure><p data-tool="mdnice编辑器">这里自动做统计检验的函数是 <code>stat_compare_means()</code></p><h6 data-tool="mdnice编辑器"><span></span><span>首先是做箱线图和小提琴图的代码</span><span></span></h6><p data-tool="mdnice编辑器">读入数据</p><pre data-tool="mdnice编辑器"><span></span><code>df&lt;-read.csv(<span>"boxplot_example_1.csv"</span>,<br>             header=T)<br>head(df)<br></code></pre><p data-tool="mdnice编辑器">作图</p><pre data-tool="mdnice编辑器"><span></span><code>library(ggplot2)<br>ggplot(data=df,aes(x=dose,y=len,fill=supp))+<br>  geom_violin()+<br>  geom_boxplot(width=0.2,<br>               position = position_dodge(0.9))+<br>  theme_bw()+<br>  theme(panel.grid = element_blank())+<br>  scale_fill_manual(values = c(<span>"yellowgreen"</span>, <span>"violetred1"</span>))<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.49274193548387096" data-src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk50nsarwTTH6rsLwNA5v4ekH6zMb4lwCd5icFFNrWMNIGZDshZEfGV2w3dh6veILtonpericZicichSyg/640?wx_fmt=png" data-type="png" data-w="1240" src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk50nsarwTTH6rsLwNA5v4ekH6zMb4lwCd5icFFNrWMNIGZDshZEfGV2w3dh6veILtonpericZicichSyg/640?wx_fmt=png"><figcaption>image.png</figcaption></figure><h6 data-tool="mdnice编辑器"><span></span><span>添加显著性检验的P值</span><span></span></h6><p data-tool="mdnice编辑器">这个函数来自于ggpubr这个包，只需要指定根据那一列来分组就可以了</p><pre data-tool="mdnice编辑器"><span></span><code>library(ggpubr)<br>ggplot(data=df,aes(x=dose,y=len,fill=supp))+<br>  geom_violin()+<br>  geom_boxplot(width=0.2,<br>               position = position_dodge(0.9))+<br>  theme_bw()+<br>  theme(panel.grid = element_blank())+<br>  scale_fill_manual(values = c(<span>"yellowgreen"</span>, <span>"violetred1"</span>))+<br>  stat_compare_means(aes(group=supp))<br></code></pre><p data-tool="mdnice编辑器">默认的是Wilcoxon Rank Sum and Signed Rank Tests，如果要用t检验指定method参数</p><pre data-tool="mdnice编辑器"><span></span><code>ggplot(data=df,aes(x=dose,y=len,fill=supp))+<br>  geom_violin()+<br>  geom_boxplot(width=0.2,<br>               position = position_dodge(0.9))+<br>  theme_bw()+<br>  theme(panel.grid = element_blank())+<br>  scale_fill_manual(values = c(<span>"yellowgreen"</span>, <span>"violetred1"</span>))+<br>  stat_compare_means(aes(group=supp),<br>                     method = <span>"t.test"</span>)<br></code></pre><p data-tool="mdnice编辑器">如果想把P值改成星号，直接加label=“p.signif”参数</p><pre data-tool="mdnice编辑器"><span></span><code>ggplot(data=df,aes(x=dose,y=len,fill=supp))+<br>  geom_violin()+<br>  geom_boxplot(width=0.2,<br>               position = position_dodge(0.9))+<br>  theme_bw()+<br>  theme(panel.grid = element_blank())+<br>  scale_fill_manual(values = c(<span>"yellowgreen"</span>, <span>"violetred1"</span>))+<br>  stat_compare_means(aes(group=supp),<br>                     method = <span>"t.test"</span>,<br>                     label=<span>"p.signif"</span>)<br></code></pre><p data-tool="mdnice编辑器">这里如果不显著会在图上显示ns，如果不想要ns，可以加<code>hide.ns = TRUE</code>参数</p><p data-tool="mdnice编辑器">星号的位置可以手动指定，用<code>label.y = c(26,31)</code>参数</p><h6 data-tool="mdnice编辑器"><span></span><span>接下来是添加线段</span><span></span></h6><p data-tool="mdnice编辑器">使用到的是<code>ggsignif</code>这个包</p><pre data-tool="mdnice编辑器"><span></span><code>  geom_signif(annotations = c(<span>""</span>,<span>""</span>),<br>              y_position = c(25,30),<br>              xmin = c(0.8,1.8),<br>              xmax = c(1.2,2.2),<br>              tip_length = c(0.02,0.4,0.02,0.2))<br></code></pre><ul data-tool="mdnice编辑器"><li><section><p><code>annotations</code> 参数后指定线段上跟什么内容，这里上面已经自动添加好星号了，所以不要任何内容了</p></section></li><li><section><p><code>y_position</code>  线段的位置</p></section></li><li><section><p><code>xmin</code> 线段的最左端</p></section></li><li><section><p><code>xmax</code> 线段的最右端</p></section></li><li><section><p><code>tip_length</code> 线段的垂直长度</p></section></li></ul><h3 data-tool="mdnice编辑器"><span></span><span>完整代码</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>df&lt;-read.csv(<span>"boxplot_example_1.csv"</span>,<br>             header=T)<br>head(df)<br>library(ggplot2)<br>library(ggpubr)<br>library(ggsignif)<br><br>ggplot(data=df,aes(x=dose,y=len,fill=supp))+<br>  geom_violin()+<br>  geom_boxplot(width=0.2,<br>               position = position_dodge(0.9))+<br>  theme_bw()+<br>  theme(panel.grid = element_blank())+<br>  scale_fill_manual(values = c(<span>"yellowgreen"</span>, <span>"violetred1"</span>))+<br>  stat_compare_means(aes(group=supp),<br>                     label=<span>"p.signif"</span>,<br>                     method = <span>"t.test"</span>,<br>                     hide.ns = TRUE,<br>                     label.y = c(26,31))+<br>  geom_signif(annotations = c(<span>""</span>,<span>""</span>),<br>              y_position = c(25,30),<br>              xmin = c(0.8,1.8),<br>              xmax = c(1.2,2.2),<br>              tip_length = c(0.02,0.4,0.02,0.2))<br></code></pre><p data-tool="mdnice编辑器">欢迎大家关注我的公众号</p><p data-tool="mdnice编辑器"><strong>小明的数据分析笔记本</strong></p><section><mpprofile data-pluginname="mpprofile" data-id="MzI3NzQ3MTcxMg==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk5t1sOnM0iabvBhnfIj5YpyqrMib0E1MGCd9ibcYxaOPZd0GWhQBDvK2BPEwsicQxd6y5MHLfphnwHnow/0?wx_fmt=png" data-nickname="小明的数据分析笔记本" data-alias="" data-signature="数据分析和数据可视化有意思的简单小例子~石榴研究生的笔记本" data-from="0"></mpprofile></section><p data-tool="mdnice编辑器"><br></p><blockquote data-tool="mdnice编辑器"><p>小明的数据分析笔记本 公众号 主要分享：1、R语言和python做数据分析和数据可视化的简单小例子；2、园艺植物相关转录组学、基因组学、群体遗传学文献阅读笔记；3、生物信息学入门学习资料及自己的学习笔记！</p></blockquote><p data-tool="mdnice编辑器">今天的推文内容会录制视频放到B站，欢迎大家关注我的B站账号 <strong>小明的数据分析笔记本</strong></p><figure data-tool="mdnice编辑器"><img data-ratio="2.2222222222222223" data-src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk50nsarwTTH6rsLwNA5v4ek7hlz0iciaEUia2pBxB8OSTkHNfsxOTOKNl66yicYQ3ic88yiayk2YibVhssYw/640?wx_fmt=png" data-type="png" data-w="1080" src="https://mmbiz.qpic.cn/mmbiz_png/t1wZDoUyFk50nsarwTTH6rsLwNA5v4ek7hlz0iciaEUia2pBxB8OSTkHNfsxOTOKNl66yicYQ3ic88yiayk2YibVhssYw/640?wx_fmt=png"><figcaption>image.png</figcaption></figure></section><p><br></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/pm67fCPX3cINedvpeBcXug",target="_blank" rel="noopener noreferrer">原文链接</a>
