---
title: "一日一技：使用 Git Worktree 实现代码的“影分身术”"
date: 2026-02-27T13:24:44Z
draft: ["false"]
tags: [
  "fetched",
  "未闻Code"
]
categories: ["Duty"]
---
一日一技：使用 Git Worktree 实现代码的“影分身术” by 未闻Code
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" data-pm-slice="0 0 []"><h2 data-tool="mdnice编辑器" data-mpa-action-id="mm4thwafpxi" data-pm-slice="0 0 []"><section nodeleaf=""><img data-aistatus="1" data-imgfileid="501507846" data-ratio="0.75" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/2kbib4svZTtDZPvVE6b2tEpmRJtP93EFrVbrrqoYuvnWUguibibw0ZoVXC0icUZJYRTecXneJITzHvFiaWb4AKUCo90CLrpZNL3DQEQ9cdaCHuyE/640?wx_fmt=jpeg&amp;from=appmsg" data-type="jpeg" data-w="1280" type="block" src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/2kbib4svZTtDZPvVE6b2tEpmRJtP93EFrVbrrqoYuvnWUguibibw0ZoVXC0icUZJYRTecXneJITzHvFiaWb4AKUCo90CLrpZNL3DQEQ9cdaCHuyE/640?wx_fmt=jpeg&amp;from=appmsg"></section><section><span leaf="" mpa-font-style="mm4thw9z1oyj"><span textstyle="">摄影：产品经理</span></span></section><section><span leaf="" mpa-font-style="mm4thw9z20gh"><span textstyle="">全熟多汁的牛排</span></span></section><section><span leaf=""><br></span></section><section><span data-pm-slice="0 0 []"><span leaf="">相信很多开发者都有过这样的经历：你正在一个叫 </span></span><code><span leaf="">feature-A</span></code><span><span leaf=""> 的分支上奋笔疾书，思路如泉涌，代码写了一半。突然，产品经理或者监控报警告诉你：线上的 </span></span><code><span leaf="">main</span></code><span><span leaf=""> 分支出了一个 P0 级的 Bug，需要你立刻、马上、Right Now 修复。</span></span></section></h2><p data-tool="mdnice编辑器"><span leaf="">这个时候，你通常有两个选择：</span></p><ol><li><section><strong><span leaf="">用 </span><code><span leaf="">git stash</span></code><span leaf=""> 暂存</span></strong><span leaf="">：把你写了一半的代码藏起来，切换到 </span><code><span leaf="">main</span></code><span leaf=""> 修 Bug，修完再切回来 </span><code><span leaf="">git stash pop</span></code><span leaf="">。缺点是不仅打断心流，而且切回来时常常面临满屏的冲突，心态瞬间爆炸。</span></section></li><li><section><span leaf=""><span textstyle="">重新</span> </span><code><span leaf="">git clone</span></code><span leaf="">：在电脑硬盘的另一个角落，重新拉取一份完整的代码库。缺点是慢，而且占用硬盘空间，特别是遇到庞大的 </span><code><span leaf="">node_modules</span></code><span leaf=""> 或者复杂的 Python 虚拟环境，重新安装依赖的时间足够你喝三杯咖啡了。</span></section></li></ol><p data-tool="mdnice编辑器"><span leaf="">今天，我们要介绍一个 Git 隐藏已久的神技——</span><strong><span leaf="">Git Worktree</span></strong><span leaf="">。它能完美解决这个问题。</span></p><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">什么是 Git Worktree？</span></span><span></span></h2><p data-tool="mdnice编辑器"><code><span leaf="">git worktree</span></code><span leaf=""> 允许你为</span><strong><span leaf="">同一个 Git 仓库同时创建多个物理工作区（文件夹）</span></strong><span leaf="">，并且每个工作区可以检出不同的分支。</span></p><p data-tool="mdnice编辑器"><span leaf="">底层其实只有一个 </span><code><span leaf="">.git</span></code><span leaf=""> 数据库，你在多个文件夹里所有的 commit、branch 都是共享的，但表面上你拥有了多个互不干扰的项目文件夹。这就是代码的“影分身术”。</span></p><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">如何使用？</span></span><span></span></h2><p data-tool="mdnice编辑器"><span leaf="">它的用法非常简单，核心只有三个命令：</span></p><h3 data-tool="mdnice编辑器"><span></span><span><span leaf="">1. 开启影分身（新建工作区）</span></span><span></span></h3><p data-tool="mdnice编辑器"><span leaf="">假设你现在在 </span><code><span leaf="">my-project</span></code><span leaf=""> 文件夹下，正在开发 </span><code><span leaf="">feature-A</span></code><span leaf="">。现在你需要修 </span><code><span leaf="">main</span></code><span leaf=""> 的 bug：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span><span leaf=""># 在当前项目文件夹的外面，新建一个叫 hotfix-dir 的文件夹，并基于 main 分支检出</span></span><span leaf=""><br></span><span leaf="">git worktree add ../hotfix-dir main</span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf="">瞬间，你在 </span><code><span leaf="">my-project</span></code><span leaf=""> 的同级目录下得到了一个全新的 </span><code><span leaf="">hotfix-dir</span></code><span leaf=""> 文件夹！ 你直接用 VSCode 等编辑器打开 </span><code><span leaf="">hotfix-dir</span></code><span leaf="">，里面干干净净就是 </span><code><span leaf="">main</span></code><span leaf=""> 的代码。你在这里修 Bug、测试、提交，而你原本在 </span><code><span leaf="">my-project</span></code><span leaf=""> 里写了一半的 </span><code><span leaf="">feature-A</span></code><span leaf=""> 代码，原封不动地躺在那里，连编辑器标签页都不需要关。</span></p><p data-tool="mdnice编辑器"><em><span leaf="" mpa-font-style="mm4tm8qg20u4" data-mpa-action-id="mm4tm8qt11td" data-pm-slice="0 0 []">提示：如果目标分支不存在，Git 会自动帮你基于当前状态创建一个新分支并拉出一个文件夹。</span></em></p><h3 data-tool="mdnice编辑器"><span></span><span><span leaf="">2. 查看所有分身</span></span><span></span></h3><p data-tool="mdnice编辑器"><span leaf="">时间久了，你可能忘了自己拉了多少个文件夹。可以通过以下命令查看：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">git worktree list</span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf="">这会列出你当前仓库关联的所有物理路径以及它们对应检出的分支。</span></p><h3 data-tool="mdnice编辑器"><span></span><span><span leaf="">3. 解除影分身（清理工作区）</span></span><span></span></h3><p data-tool="mdnice编辑器"><span leaf="">当 Bug 修完，那个临时拉出来的 </span><code><span leaf="">hotfix-dir</span></code><span leaf=""> 文件夹没用了怎么办？ 你可以直接在资源管理器/终端里像删普通文件夹一样把它删掉（</span><code><span leaf="">rm -rf ../hotfix-dir</span></code><span leaf="">）。</span></p><p data-tool="mdnice编辑器"><span leaf="">删掉之后，告诉 Git 底层清理一下记录：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">git worktree prune</span><span leaf=""><br></span></code></pre><p data-tool="mdnice编辑器"><span leaf="">或者，你也可以使用更优雅的命令直接移除：</span></p><pre data-tool="mdnice编辑器"><span data-cacheurl="" data-remoteid=""></span><code><span leaf="">git worktree remove ../hotfix-dir</span><span leaf=""><br></span></code></pre><h2 data-tool="mdnice编辑器"><span></span><span><span leaf="">AI 时代的大杀器：并行计算与多智能体（Multi-Agent）</span></span><span></span></h2><p data-tool="mdnice编辑器"><span leaf="">以前我们认为 </span><code><span leaf="">git worktree</span></code><span leaf=""> 只是为了防止程序员被打断的效率工具，但在进入 </span><strong><span leaf="">Agent（智能体）时代</span></strong><span leaf="">的今天，它的意义被无限放大了。</span></p><p data-tool="mdnice编辑器"><span leaf="">最近在研究基于 AI Agent 的自主编程时，我发现 Anthropic 内部在使用 Multi-Agent（多智能体）组队时，大量使用了 Git Worktree 的机制。</span></p><p data-tool="mdnice编辑器"><span leaf="">当我们要重构一个复杂的模块，但不确定哪种技术方案最好时：</span></p><ul><li><section><strong><span leaf="">如果是人类或单 Agent</span></strong><span leaf="">：只能先试 A 方案，不行再回滚代码试 B 方案……这是串行试错，极其缓慢。</span></section></li><li><section><strong><span leaf="">如果是 Multi-Agent + Worktree</span></strong><span leaf="">：主 Agent 可以瞬间执行三次 </span><code><span leaf="">git worktree add</span></code><span leaf="">，在硬盘上拉出三个平行文件夹。然后派出三个子 Agent（SubAgent），</span><strong><span leaf="">同时</span></strong><span leaf="">在这三个文件夹里独立写代码、装依赖、跑测试。三个 Agent 物理隔离互不干扰，但它们的成果都汇总在同一个底层的 </span><code><span leaf="">.git</span></code><span leaf=""> 里。最后，谁的测试跑分高、代码质量好，就合并谁的分支，删掉另外两个。</span></section></li></ul><p data-tool="mdnice编辑器"><strong><span leaf="">这是用并行计算的方式在做决策。用三分之一的时间，探索了三倍的可能性。</span></strong></p><p data-tool="mdnice编辑器"><span leaf="">下次当你写代码再被打断，或者想让你的本地 AI Agent 帮你“兵分几路”测试代码时，不妨试试 </span><code><span leaf="">git worktree</span></code><span leaf=""> 这个魔法吧。</span></p><section nodeleaf=""><img data-aistatus="1" data-imgfileid="501506620" data-ratio="0.5625" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/ohoo1dCmvqficd5dvzOUvUV9YAfl2AUtMBibtrr700SAhfeeuZPBmLRoTxOOQLBuHtoJicECTJQAiaOHFLOsc8Y0bw/640?wx_fmt=jpeg&amp;from=appmsg" data-type="jpeg" data-w="1280" type="block" src="https://mmbiz.qpic.cn/mmbiz_jpg/ohoo1dCmvqficd5dvzOUvUV9YAfl2AUtMBibtrr700SAhfeeuZPBmLRoTxOOQLBuHtoJicECTJQAiaOHFLOsc8Y0bw/640?wx_fmt=jpeg&amp;from=appmsg"></section><section data-pm-slice="0 0 []"><section><section><section><section><svg viewbox="0 0 1 1"></svg></section></section></section><section><section><p><span leaf="">END</span></p></section><section><section><svg viewbox="0 0 1 1"></svg></section></section></section><section><section><section><svg viewbox="0 0 1 1"></svg></section></section></section></section><section><section nodeleaf=""><img data-aistatus="1" data-imgfileid="501507845" data-ratio="0.5490741" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/2kbib4svZTtAqzy6rqm6jPep9IdlMCeD9AG4g8Fia0MN6iadubIWPMEhq7R0MKf5Ny8icibsOKel80HM0evyEV6N191gNKaGiab062nZ9ibEiauwBNo/640?wx_fmt=jpeg&amp;from=appmsg" data-type="jpeg" data-w="1080" src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/2kbib4svZTtAqzy6rqm6jPep9IdlMCeD9AG4g8Fia0MN6iadubIWPMEhq7R0MKf5Ny8icibsOKel80HM0evyEV6N191gNKaGiab062nZ9ibEiauwBNo/640?wx_fmt=jpeg&amp;from=appmsg"></section></section><section><p><span><span leaf="">未闻 Code·知识星球开放啦！</span></span></p><p><span leaf="">一对一答疑爬虫相关问题</span></p><p><span leaf="">职业生涯咨询</span></p><p><span leaf="">面试经验分享</span></p><p><span leaf="">每周直播分享</span></p><p><span leaf="">......</span></p><p><span leaf="">未闻 Code·知识星球期待与你相见~</span></p><section nodeleaf=""><img data-aistatus="1" data-imgfileid="501494151" data-ratio="0.5555555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_gif/ohoo1dCmvqeiagWjcfyicsibNKgNOEnyAkb06AMF5eG1K2jEXjUxqkV9EUaNXIjDEibQPAV2sJak2dJibiamc2jw0z6g/640?wx_fmt=gif" data-type="gif" data-w="639" type="block" src="https://mmbiz.qpic.cn/mmbiz_gif/ohoo1dCmvqeiagWjcfyicsibNKgNOEnyAkb06AMF5eG1K2jEXjUxqkV9EUaNXIjDEibQPAV2sJak2dJibiamc2jw0z6g/640?wx_fmt=gif"></section></section></section></section><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/UoNzl5pSUEzq3WwR_Li20Q",target="_blank" rel="noopener noreferrer">原文链接</a>
