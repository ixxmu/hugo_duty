---
title: "R实战| PCA、tSNE、UMAP三种降维方法在R中的实现"
date: 2022-09-23T06:51:04Z
draft: ["false"]
tags: [
  "fetched",
  "木舟笔记"
]
categories: ["Duty"]
---
R实战| PCA、tSNE、UMAP三种降维方法在R中的实现 by 木舟笔记
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" data-mpa-powered-by="yiban.io"><figure data-tool="mdnice编辑器"><img data-ratio="0.4255555555555556" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/aMicyicM8Ll1ibzEtLnvCwzibvMZXeMcEVXcDLckSEk5UicwOHD0rpdEiceuk3RnK0bxO0hXxq1gqlwfJCmoFe65Ybsw/640?wx_fmt=jpeg" data-type="jpeg" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_jpg/aMicyicM8Ll1ibzEtLnvCwzibvMZXeMcEVXcDLckSEk5UicwOHD0rpdEiceuk3RnK0bxO0hXxq1gqlwfJCmoFe65Ybsw/640?wx_fmt=jpeg"><figcaption><span></span>降维</figcaption></figure><p data-tool="mdnice编辑器">在组学分析中，一般通过降维算法得到低纬度如二维或三维的新坐标数据，再结合可视化技术去展示样本的在新坐标的空间分布，接着加上统计检验结果证实整体组学水平上组间的差异性。降维算法有基于<code>线性</code>模型的<code>PCA</code>，也有基于<code>非线性</code>的<code>tSNE</code>和<code>UMAP</code>等方法。</p><section><mpprofile data-pluginname="mpprofile" data-id="MzIxMDExNDE0OQ==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/aMicyicM8Ll1ib0O4bhukQJ50YEnDwcMTIvaj1jSnOACbZmy7XsUAmicqyoF1WkNzzwian0IUUbGlNmaniaMDXLsa6pA/0?wx_fmt=png" data-nickname="木舟笔记" data-alias="MZBJNOTE" data-signature="分享学习干货，生信教程，机器学习基础。" data-from="0"></mpprofile></section><h2 data-tool="mdnice编辑器"><span></span><span>示例数据和代码领取</span><span></span></h2><p data-tool="mdnice编辑器"><code>点赞</code>、<code>在看</code> 本文，分享至朋友圈<code>集赞20个</code>并<code>保留30分钟</code>，截图发至微信<code>mzbj0002</code>领取。</p><p data-tool="mdnice编辑器"><strong>「木舟笔记2022年度VIP可免费领取」</strong>。</p><h3 data-tool="mdnice编辑器"><span></span><span><span></span>木舟笔记2022年度VIP企划</span><span></span></h3><p data-tool="mdnice编辑器"><strong>「权益：」</strong></p><ol data-tool="mdnice编辑器"><li><section><p><strong>「2022」</strong>年度木舟笔记所有推文示例数据及代码(<strong>「在VIP群里实时更新」</strong>)。</p><figure><img data-ratio="0.48011049723756904" data-src="https://mmbiz.qpic.cn/mmbiz_png/aMicyicM8Ll1ibzEtLnvCwzibvMZXeMcEVXcXV9FWD0wYDKSfUbt6BCB0AYUmBhhJNl7stBsoUAkoIWTJkB3EKcAVg/640?wx_fmt=png" data-type="png" data-w="1810" src="https://mmbiz.qpic.cn/mmbiz_png/aMicyicM8Ll1ibzEtLnvCwzibvMZXeMcEVXcXV9FWD0wYDKSfUbt6BCB0AYUmBhhJNl7stBsoUAkoIWTJkB3EKcAVg/640?wx_fmt=png"><figcaption><span></span>资源合集</figcaption></figure></section></li><li><section><p>木舟笔记<strong>「科研交流群」</strong>。</p></section></li><li><section><p><strong>「半价」</strong>购买<code>跟着Cell学作图系列合集</code><a href="http://mp.weixin.qq.com/s?__biz=MzIxMDExNDE0OQ==&amp;mid=2247486072&amp;idx=1&amp;sn=d579a62420f722285eac318c4114d199&amp;chksm=9768c972a01f4064a84f30fd48b8c2107af543c31b6adb5f36234b1377ac42c8af54f45efda9&amp;scene=21#wechat_redirect" data-linktype="2">(免费教程+代码领取)|跟着Cell学作图系列合集</a>。</p></section></li></ol><p data-tool="mdnice编辑器"><strong>「收费：」</strong></p><p data-tool="mdnice编辑器">	<strong>「99￥/人」</strong>。可添加微信：<code>mzbj0002</code> 转账，或直接在文末打赏。</p><img data-ratio="1.1384615384615384" data-src="https://mmbiz.qpic.cn/mmbiz_png/aMicyicM8Ll1ibzEtLnvCwzibvMZXeMcEVXc9WsxzgDqohR5P8WSFQUicoBcgaSCpteCXSMHbqZ0tjT4icK0tWBN0BXQ/640?wx_fmt=png" data-type="png" data-w="520" src="https://mmbiz.qpic.cn/mmbiz_png/aMicyicM8Ll1ibzEtLnvCwzibvMZXeMcEVXc9WsxzgDqohR5P8WSFQUicoBcgaSCpteCXSMHbqZ0tjT4icK0tWBN0BXQ/640?wx_fmt=png"><h2 data-tool="mdnice编辑器"><span></span><span>PCA</span><span></span></h2><p data-tool="mdnice编辑器">主成分分析（Principal Component Analysis，PCA）是最常用的无监督学习方法。</p><pre data-tool="mdnice编辑器"><span></span><code>rm(list = ls())<br><span>library</span>(tidyverse)<br><span>library</span>(broom)<br><span>library</span>(palmerpenguins)<br><br><span># 示例数据</span><br>penguins &lt;- penguins %&gt;%<br>  drop_na() %&gt;%<br>  select(-year)<br>head(penguins)<br><br><span># 使用prcomp()进行PCA</span><br><span># PCA前对数值型数据进行标准化</span><br>pca_fit &lt;- penguins %&gt;%<br>  select(where(is.numeric)) %&gt;%<br>  scale() %&gt;%<br>  prcomp()<br><span># 查看成分重要性</span><br>summary(pca_fit)<br><br><span># 可视化PC1和PC2</span><br>pca_fit %&gt;%<br>  augment(penguins) %&gt;%<br>  rename_at(vars(starts_with(<span>".fitted"</span>)),<br>            list(~str_replace(.,<span>".fitted"</span>,<span>""</span>))) %&gt;%<br>  ggplot(aes(x=PC1, <br>             y=PC2,<br>             color=species,<br>             shape=sex))+<br>  geom_point()<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.7219827586206896" data-src="https://mmbiz.qpic.cn/mmbiz_png/aMicyicM8Ll1ibzEtLnvCwzibvMZXeMcEVXcFOYvpSLFzURMOl3ib6SNyFUDmVic2HLNhbwzTNCsf9ekicpGibpja8DibrA/640?wx_fmt=png" data-type="png" data-w="928" src="https://mmbiz.qpic.cn/mmbiz_png/aMicyicM8Ll1ibzEtLnvCwzibvMZXeMcEVXcFOYvpSLFzURMOl3ib6SNyFUDmVic2HLNhbwzTNCsf9ekicpGibpja8DibrA/640?wx_fmt=png"><figcaption><span></span>PCA plot: PC1 vs PC2</figcaption></figure><h2 data-tool="mdnice编辑器"><span></span><span>UMAP</span><span></span></h2><h3 data-tool="mdnice编辑器"><span></span><span><span></span>数据预处理</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code><span>## UMAP</span><br>rm(list = ls())<br><span>library</span>(tidyverse)<br><span>library</span>(palmerpenguins)<br><span>#install.packages("umap")</span><br><span>library</span>(umap)<br>theme_set(theme_bw(<span>18</span>))<br><br>penguins &lt;- penguins %&gt;% <br>  drop_na() %&gt;%<br>  select(-year)%&gt;%<br>  mutate(ID=row_number()) <br><br>penguins_meta &lt;- penguins %&gt;%<br>  select(ID, species, island, sex)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>使用umap包进行umap分析</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>set.seed(<span>142</span>)<br>umap_fit &lt;- penguins %&gt;%<br>  select(where(is.numeric)) %&gt;%<br>  column_to_rownames(<span>"ID"</span>) %&gt;%<br>  scale() %&gt;% <br>  umap()<br><br>umap_df &lt;- umap_fit$layout %&gt;%<br>  as.data.frame()%&gt;%<br>  rename(UMAP1=<span>"V1"</span>,<br>         UMAP2=<span>"V2"</span>) %&gt;%<br>  mutate(ID=row_number())%&gt;%<br>  inner_join(penguins_meta, by=<span>"ID"</span>)<br>umap_df %&gt;% head()<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>可视化</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code><span># 可视化</span><br>umap_df %&gt;%<br>  ggplot(aes(x = UMAP1, <br>             y = UMAP2, <br>             color = species,<br>             shape = sex))+<br>  geom_point()+<br>  labs(x = <span>"UMAP1"</span>,<br>       y = <span>"UMAP2"</span>,<br>       subtitle = <span>"UMAP plot"</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.7768147345612134" data-src="https://mmbiz.qpic.cn/mmbiz_png/aMicyicM8Ll1ibzEtLnvCwzibvMZXeMcEVXcWqY8WKuudXbCia2ZX7NyCeePLRLFGs0Cn0XVssFAhzgeHIDG2Rtm7lw/640?wx_fmt=png" data-type="png" data-w="923" src="https://mmbiz.qpic.cn/mmbiz_png/aMicyicM8Ll1ibzEtLnvCwzibvMZXeMcEVXcWqY8WKuudXbCia2ZX7NyCeePLRLFGs0Cn0XVssFAhzgeHIDG2Rtm7lw/640?wx_fmt=png"><figcaption><span></span>UMAP plot in R: Example 1</figcaption></figure><pre data-tool="mdnice编辑器"><span></span><code><span># 分面</span><br>umap_df %&gt;%<br>  ggplot(aes(x = UMAP1, <br>             y = UMAP2,<br>             color = species)) +<br>  geom_point(size=<span>3</span>, alpha=<span>0.5</span>)+<br>  facet_wrap(~island)+<br>  labs(x = <span>"UMAP1"</span>,<br>       y = <span>"UMAP2"</span>,<br>       subtitle=<span>"UMAP plot"</span>)+<br>  theme(legend.position=<span>"bottom"</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.75" data-src="https://mmbiz.qpic.cn/mmbiz_png/aMicyicM8Ll1ibzEtLnvCwzibvMZXeMcEVXcHnjq4sgyiavYXeMtXHSX6XrykicFC23Ym62RN7lVPkyqEUa9UoUSKhoA/640?wx_fmt=png" data-type="png" data-w="952" src="https://mmbiz.qpic.cn/mmbiz_png/aMicyicM8Ll1ibzEtLnvCwzibvMZXeMcEVXcHnjq4sgyiavYXeMtXHSX6XrykicFC23Ym62RN7lVPkyqEUa9UoUSKhoA/640?wx_fmt=png"><figcaption><span></span>UMAP plot in R: Example 2</figcaption></figure><pre data-tool="mdnice编辑器"><span></span><code><span># 圈出异常样本</span><br><span>library</span>(ggforce)<br>umap_df %&gt;%<br>  ggplot(aes(x = UMAP1,<br>             y = UMAP2, <br>             color = species,<br>             shape = sex)) +<br>  geom_point() +<br>  labs(x = <span>"UMAP1"</span>,<br>       y = <span>"UMAP2"</span>,<br>       subtitle=<span>"UMAP plot"</span>) +<br>  geom_circle(aes(x0 = -<span>5</span>, y0 = -<span>3.8</span>, r = <span>0.65</span>), <br>              color = <span>"green"</span>,<br>              inherit.aes = <span>FALSE</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.7588466579292268" data-src="https://mmbiz.qpic.cn/mmbiz_png/aMicyicM8Ll1ibzEtLnvCwzibvMZXeMcEVXcnrjdKW2oIOibJia8HcsUibxcrJsyL98ibicDEJVpFXRZkc763mle9xibIKaQ/640?wx_fmt=png" data-type="png" data-w="763" src="https://mmbiz.qpic.cn/mmbiz_png/aMicyicM8Ll1ibzEtLnvCwzibvMZXeMcEVXcnrjdKW2oIOibJia8HcsUibxcrJsyL98ibicDEJVpFXRZkc763mle9xibIKaQ/640?wx_fmt=png"><figcaption><span></span>UMAP Plot to Identify Potential sample mix-ups</figcaption></figure><h2 data-tool="mdnice编辑器"><span></span><span>tSNE</span><span></span></h2><h3 data-tool="mdnice编辑器"><span></span><span><span></span>数据预处理</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code><span>## tSNE</span><br>rm(list = ls())<br><span>library</span>(tidyverse)<br><span>library</span>(palmerpenguins)<br><span>library</span>(Rtsne)<br>theme_set(theme_bw(<span>18</span>))<br><br>penguins &lt;- penguins %&gt;% <br>  drop_na() %&gt;%<br>  select(-year)%&gt;%<br>  mutate(ID=row_number())<br><br>penguins_meta &lt;- penguins %&gt;%<br>  select(ID,species,island,sex)<br></code></pre><h3 data-tool="mdnice编辑器"><span></span><span><span></span>使用Rtsne 包进行tSNE 分析</span><span></span></h3><pre data-tool="mdnice编辑器"><span></span><code>set.seed(<span>142</span>)<br>tSNE_fit &lt;- penguins %&gt;%<br>  select(where(is.numeric)) %&gt;%<br>  column_to_rownames(<span>"ID"</span>) %&gt;%<br>  scale() %&gt;% <br>  Rtsne()<br><br>tSNE_df &lt;- tSNE_fit$Y %&gt;% <br>  as.data.frame() %&gt;%<br>  rename(tSNE1=<span>"V1"</span>,<br>         tSNE2=<span>"V2"</span>) %&gt;%<br>  mutate(ID=row_number())<br><br>tSNE_df &lt;- tSNE_df %&gt;%<br>  inner_join(penguins_meta, by=<span>"ID"</span>)<br><br>tSNE_df %&gt;% head()<br></code></pre><h2 data-tool="mdnice编辑器"><span></span><span>可视化</span><span></span></h2><pre data-tool="mdnice编辑器"><span></span><code>tSNE_df %&gt;%<br>  ggplot(aes(x = tSNE1, <br>             y = tSNE2,<br>             color = species,<br>             shape = sex))+<br>  geom_point()+<br>  theme(legend.position=<span>"bottom"</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.7194719471947195" data-src="https://mmbiz.qpic.cn/mmbiz_png/aMicyicM8Ll1ibzEtLnvCwzibvMZXeMcEVXcMpial89b7iaLSeQ8ZjtwrLj86H4LGI4dqxiay8YvwicbB5ibbc4cQiaMMI2g/640?wx_fmt=png" data-type="png" data-w="909" src="https://mmbiz.qpic.cn/mmbiz_png/aMicyicM8Ll1ibzEtLnvCwzibvMZXeMcEVXcMpial89b7iaLSeQ8ZjtwrLj86H4LGI4dqxiay8YvwicbB5ibbc4cQiaMMI2g/640?wx_fmt=png"><figcaption><span></span>tSNE Plot</figcaption></figure><h2 data-tool="mdnice编辑器"><span></span><span>参考</span><span></span></h2><ol data-tool="mdnice编辑器"><li><section>How To Make tSNE plot in R - Data Viz with Python and R (datavizpyr.com)</section></li><li><section>How to make UMAP plot in R - Data Viz with Python and R (datavizpyr.com)</section></li><li><section>How To Make PCA Plot with R - Data Viz with Python and R (datavizpyr.com)</section></li></ol><h2 data-tool="mdnice编辑器"><span></span><span>往期内容</span><span></span></h2><ol data-tool="mdnice编辑器"><li><section><a href="http://mp.weixin.qq.com/s?__biz=MzIxMDExNDE0OQ==&amp;mid=2247488950&amp;idx=1&amp;sn=8c06246890d3cee4a3297829e404beba&amp;chksm=9768d6bca01f5faaba25bf32d3a895f61b4dac7b5daed38deb147f7f1702291a43154da6958d&amp;scene=21#wechat_redirect" data-linktype="2">CNS图表复现|生信分析|R绘图 资源分享&amp;讨论群！</a></section></li><li><section><a href="http://mp.weixin.qq.com/s?__biz=MzIxMDExNDE0OQ==&amp;mid=2247489004&amp;idx=1&amp;sn=0654118a49fd0cc3b97a7fe6535e4849&amp;chksm=9768d6e6a01f5ff0758a740c3e1cf9a72cfeb4784d064862f4eac822f78a716371c5f7cfbce7&amp;scene=21#wechat_redirect" data-linktype="2">组学生信| Front Immunol |基于血清蛋白质组早期诊断标志筛选的简单套路</a></section></li></ol><hr data-tool="mdnice编辑器"><figure data-tool="mdnice编辑器"><img data-ratio="0.6676163342830009" data-src="https://mmbiz.qpic.cn/mmbiz_png/aMicyicM8Ll1ibzEtLnvCwzibvMZXeMcEVXcEyiaEEBxSrSgX5fF2Trp9uyvgZJiaL0EM18egQZIZiccicxbgAvv81SO6g/640?wx_fmt=png" data-type="png" data-w="1053" src="https://mmbiz.qpic.cn/mmbiz_png/aMicyicM8Ll1ibzEtLnvCwzibvMZXeMcEVXcEyiaEEBxSrSgX5fF2Trp9uyvgZJiaL0EM18egQZIZiccicxbgAvv81SO6g/640?wx_fmt=png"><figcaption><span></span>木舟笔记矩阵</figcaption></figure></section><p><br></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/VWfMo_FGNkolKSHNC8a6IQ",target="_blank" rel="noopener noreferrer">原文链接</a>
