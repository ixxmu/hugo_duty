---
title: "泛癌症单细胞分析揭示了肿瘤微环境中肿瘤相关成纤维细胞的异质性和可塑性"
date: 2022-11-24T05:01:12Z
draft: ["false"]
tags: [
  "fetched",
  "生信菜鸟团"
]
categories: ["Duty"]
---
泛癌症单细胞分析揭示了肿瘤微环境中肿瘤相关成纤维细胞的异质性和可塑性 by 生信菜鸟团
------
<div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><blockquote data-tool="mdnice编辑器"><p>这周推文是对一篇今年刚发的文章所用的数据集进行了复现，GSE210347，由于文章所用数据太大，用个人电脑进行复现请谨慎。</p></blockquote><p data-tool="mdnice编辑器"><strong>文章：</strong>Pan-cancer single-cell analysis reveals the heterogeneity and plasticity of cancer associated fibroblasts in the tumor microenvironment.  https://doi.org/10.1038/s41467-022-34395-2</p><figure data-tool="mdnice编辑器"><img data-ratio="0.3866995073891626" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9IP02mdH9Jvxqp1zMx7ORDQgVQXK2hYraAEnRvhBbLQpn8a382CLfnsqPpnlAh23A4D2iaJnn3ccw/640?wx_fmt=png" data-type="png" data-w="1218" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9IP02mdH9Jvxqp1zMx7ORDQgVQXK2hYraAEnRvhBbLQpn8a382CLfnsqPpnlAh23A4D2iaJnn3ccw/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器"><strong>文献简介：</strong>肿瘤相关成纤维细胞(CAFs)是肿瘤微环境(TME)的主要组成部分，影响肿瘤标志物的表达，但目前尚未对其在不同肿瘤类型中的普遍存在特征进行系统研究。在这里，为了分析实体癌的TME情况，对10种实体癌的226个样本进行了泛癌分析，这些数据来自12项研究的164个供体的148个原发肿瘤、53个邻近肿瘤和25个正常样本。以描绘单细胞分辨率下的TME，说明异质性CAFs的共性/可塑性。</p><p data-tool="mdnice编辑器"><strong>数据集：</strong> 总共纳入了232个单细胞转录组样本(正常= 31;相邻= 54;Tumor = 148)。其中，31个GSM样本来自GSE134355;11个GSM样本与GSE141445相关;49例样本来自EMBL-EBI的ArrayExpress数据库(www.ebi.ac.uk/arrayexpress)，登录号为E-MTAB-8107;2例GSM样本与GSE157703关联;22个GSM样本来源于GSE131907;7个GSM样本来自GSE138709; 31例样本来自EMBL-EBI的ArrayExpress数据库(www.ebi.ac.uk/arrayexpress)，登录号为E-MTAB-6149和E-MTAB-6653; 32例CRR样本与GSA数据库相关，登录号为CRA001160; 10个GSM样本与GSE154778相关; 7份HRR样本可在GSA-Human中获得，登录码为HRA000212; 10例甲状腺样本来源于GSA-Human数据库，登录号为HRA000686; 从http://dna-discovery.stanford.edu/download/1401/下载20份胃标本。</p><p data-tool="mdnice编辑器">汇总好的数据也上传在GEO数据库中为GSE210347</p><figure data-tool="mdnice编辑器"><img data-ratio="0.08508508508508508" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9IP02mdH9Jvxqp1zMx7ORDt1AyGJkuEwvtMhOFzuwFRNn8WicoMB7FSj7EyDtSvdwj87s5IwY3QoQ/640?wx_fmt=png" data-type="png" data-w="999" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9IP02mdH9Jvxqp1zMx7ORDt1AyGJkuEwvtMhOFzuwFRNn8WicoMB7FSj7EyDtSvdwj87s5IwY3QoQ/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器"><strong>文章复现图：</strong></p><figure data-tool="mdnice编辑器"><img data-ratio="0.6601423487544484" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9IP02mdH9Jvxqp1zMx7ORDVD7RT7aph2ELtwwlcKRA5TPzo64GCOFLDC5vynTpddIE5RM5RxOebw/640?wx_fmt=png" data-type="png" data-w="562" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9IP02mdH9Jvxqp1zMx7ORDVD7RT7aph2ELtwwlcKRA5TPzo64GCOFLDC5vynTpddIE5RM5RxOebw/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器"><strong>step1:导入数据</strong></p><pre data-tool="mdnice编辑器"><span></span><code>rm(list=ls())<br>options(stringsAsFactors = <span>F</span>) <br><span>library</span>(Seurat)<br><span>library</span>(ggplot2)<br><span>library</span>(clustree)<br><span>library</span>(cowplot)<br><span>library</span>(dplyr)<br> <br><span>###### step1:导入数据 ######  </span><br>sce.all=readRDS(<span>"GSE210347_counts.Rds"</span>)<br>sce=CreateSeuratObject(sce.all)<br>table(sce$orig.ident)<br>head(colnames(sce))<br>tail(colnames(sce))<br>sce@assays$RNA@counts[<span>1</span>:<span>10</span>, <span>1</span>:<span>2</span>]<br><br>table(sce$orig.ident)<br>sce$group&lt;-ifelse(grepl(<span>"Colon|um|scrEXT"</span>,colnames(sce)),<span>"colorectal"</span>,<br>    ifelse(grepl(<span>"Bladder1|Bladder2|GallBladder1|GallBladder2"</span>,colnames(sce)),<span>"bladder"</span>,<br>                         ifelse(grepl(<span>"Liver"</span>,colnames(sce)),<span>"liver"</span>,<br>                                ifelse(grepl(<span>"Lung|Sample"</span>,colnames(sce)),<span>"lung"</span>,<br>                                      ifelse(grepl(<span>"Pancreas|PDAC"</span>,colnames(sce)),<span>"PDAC"</span>,<br>                                         ifelse(grepl(<span>"thyroid"</span>,colnames(sce)),<span>"thyroid"</span>,<br>                                 ifelse(grepl(<span>"gastric|Stomach"</span>,colnames(sce)),<span>"gastric"</span>,<br>                                      ifelse(grepl(<span>"prostate"</span>,colnames(sce)),<span>"prostate"</span>,                           ifelse(grepl(<span>"BT"</span>,colnames(sce)),<span>"ovarian"</span>,<span>"breast"</span>)))))))))<br><br>table(sce$group)<br></code></pre><p data-tool="mdnice编辑器"><strong>step2: QC 在此省略</strong></p><p data-tool="mdnice编辑器"><strong>step3:降维分群</strong></p><pre data-tool="mdnice编辑器"><span></span><code><span>#rm(list=ls()) </span><br>dir.create(<span>"2-harmony"</span>)<br>getwd()<br>setwd(<span>"2-harmony"</span>)<br><br>sce=sce.all <br>sce <br>sce &lt;- NormalizeData(sce, <br>                         normalization.method = <span>"LogNormalize"</span>,<br>                         scale.factor = <span>1e4</span>) <br>sce &lt;- FindVariableFeatures(sce)<br>sce &lt;- ScaleData(sce)<br>sce &lt;- RunPCA(sce, features = VariableFeatures(object = sce))<br><br><span>library</span>(harmony)<br>seuratObj &lt;- RunHarmony(sce, <span>"orig.ident"</span>)<br>names(seuratObj@reductions)<br>seuratObj &lt;- RunUMAP(seuratObj,  dims = <span>1</span>:<span>15</span>, <br>                     reduction = <span>"harmony"</span>)<br>DimPlot(seuratObj,reduction = <span>"umap"</span>,label=<span>T</span> ) <br><br>sce=seuratObj<br>sce &lt;- FindNeighbors(sce, reduction = <span>"harmony"</span>,<br>                     dims = <span>1</span>:<span>15</span>) <br>sce.all=sce<br><br><span>#接下来分析，按照分辨率为0.3进行 </span><br>sel.clust = <span>"RNA_snn_res.0.3"</span><br>sce.all &lt;- SetIdent(sce.all, value = sel.clust)<br>table(sce.all@active.ident) <br>saveRDS(sce.all, <span>"sce.all_int.rds"</span>)<br></code></pre><p data-tool="mdnice编辑器"><strong>step4:检查常见分群情况</strong></p><pre data-tool="mdnice编辑器"><span></span><code><span>###### step5 检查常见分群情况  ######</span><br>dir.create(<span>"../3-cell"</span>)<br>setwd(<span>"../3-cell"</span>)  <br><br>DimPlot(sce.all, reduction = <span>"umap"</span>, group.by = <span>"seurat_clusters"</span>,label = <span>T</span>) <br>DimPlot(sce.all, reduction = <span>"umap"</span>, group.by = <span>"RNA_snn_res.0.3"</span>,label = <span>T</span>) <br>ggsave(<span>'umap_by_RNA_snn_res.0.3.pdf'</span>)<br><br><span>library</span>(ggplot2) <br>genes_to_check = c(<span>'PTPRC'</span>, <span>'CD3D'</span>, <span>'CD3E'</span>, <span>'CD4'</span>,<span>'CD8A'</span>,<br>                   <span>'CD19'</span>, <span>'CD79A'</span>, <span>'MS4A1'</span> ,<br>                   <span>'IGHG1'</span>, <span>'MZB1'</span>, <span>'SDC1'</span>,<br>                   <span>'CD68'</span>, <span>'CD163'</span>, <span>'CD14'</span>, <br>                   <span>'TPSAB1'</span> , <span>'TPSB2'</span>,  <span># mast cells,</span><br>                   <span>'RCVRN'</span>,<span>'FPR1'</span> , <span>'ITGAM'</span> ,<br>                   <span>'C1QA'</span>,  <span>'C1QB'</span>,  <span># mac</span><br>                   <span>'S100A9'</span>, <span>'S100A8'</span>, <span>'MMP19'</span>,<span># monocyte</span><br>                   <span>'FCGR3A'</span>,<br>                   <span>'LAMP3'</span>, <span>'IDO1'</span>,<span>'IDO2'</span>,<span>## DC3 </span><br>                   <span>'CD1E'</span>,<span>'CD1C'</span>, <span># DC2</span><br>                   <span>'KLRB1'</span>,<span>'NCR1'</span>, <span># NK </span><br>                   <span>'FGF7'</span>,<span>'MME'</span>, <span>'ACTA2'</span>, <span>## fibo </span><br>                   <span>'DCN'</span>, <span>'LUM'</span>,  <span>'GSN'</span> , <span>## mouse PDAC fibo </span><br>                   <span>'Amy1'</span> , <span>'Amy2a2'</span>, <span># Acinar_cells</span><br>                   <span>'PECAM1'</span>, <span>'VWF'</span>,  <span>## endo </span><br>                   <span>'EPCAM'</span> , <span>'KRT19'</span>, <span>'PROM1'</span>, <span>'ALDH1A1'</span> )<br><br><span>library</span>(stringr)  <br>genes_to_check=str_to_upper(genes_to_check)<br>genes_to_check<br>p &lt;- DotPlot(sce.all, features = unique(genes_to_check),<br>             assay=<span>'RNA'</span>)  + coord_flip()<br><br>p <br>ggsave(<span>'check_last_markers.pdf'</span>,height = <span>11</span>,width = <span>11</span>)<br><br><br>p_umap=DimPlot(sce.all, reduction = <span>"umap"</span>,<br>               group.by = <span>"RNA_snn_res.0.3"</span>,label = <span>T</span>) <br><span>library</span>(patchwork)<br>p+p_umap<br>ggsave(<span>'markers_umap.pdf'</span>,width = <span>20</span>,height = <span>12</span>)<br>DimPlot(sce.all, reduction = <span>"umap"</span>,split.by = <span>'orig.ident'</span>,<br>        group.by = <span>"RNA_snn_res.0.3"</span>,label = <span>T</span>) <br>ggsave(<span>'orig.ident_umap.pdf'</span>,width = <span>30</span>,height = <span>5</span>)<br>DimPlot(sce.all, reduction = <span>"umap"</span>,split.by = <span>'group'</span>,<br>        group.by = <span>"RNA_snn_res.0.3"</span>,label = <span>T</span>) <br>ggsave(<span>'group_umap.pdf'</span>,width = <span>30</span>,height = <span>5</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.5995525727069351" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9IP02mdH9Jvxqp1zMx7ORDTmNseE5DeIMnoRib64W7icsUFS5ufVClob6Aiaa0NPkh1ricmR5aLXcX8A/640?wx_fmt=png" data-type="png" data-w="1341" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9IP02mdH9Jvxqp1zMx7ORDTmNseE5DeIMnoRib64W7icsUFS5ufVClob6Aiaa0NPkh1ricmR5aLXcX8A/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器"><strong>step5：细胞亚群生物学命名</strong></p><pre data-tool="mdnice编辑器"><span></span><code>table(sce.all@meta.data$RNA_snn_res.0.3)<br>  <span>#细胞分群命名</span><br>  celltype=data.frame(ClusterID=<span>0</span>:<span>29</span>,<br>                      celltype= <span>0</span>:<span>29</span>) <br>  <br>  <span>#定义细胞亚群  </span><br>  celltype[celltype$ClusterID %<span>in</span>% c(<span>0</span>,<span>15</span>,<span>17</span>,<span>19</span>,<span>21</span>,<span>22</span>),<span>2</span>]=<span>'T cells'</span><br>  celltype[celltype$ClusterID %<span>in</span>% c(<span>16</span>,<span>26</span>,<span>9</span>),<span>2</span>]=<span>'B cells'</span><br>  celltype[celltype$ClusterID %<span>in</span>% c(<span>18</span>),<span>2</span>]=<span>'mast'</span><br>  celltype[celltype$ClusterID %<span>in</span>% c(<span>1</span>,<span>23</span>,<span>5</span>,<span>28</span>),<span>2</span>]=<span>'myeloid'</span><br>  <br>  celltype[celltype$ClusterID %<span>in</span>% c(<span>4</span>,<span>6</span>,<span>7</span>,<span>10</span>,<span>11</span>,<span>12</span>,<span>13</span>,<span>24</span>,<span>25</span>,<span>27</span>,<span>14</span>,<span>20</span>),<span>2</span>]=<span>'epi'</span><br>  celltype[celltype$ClusterID %<span>in</span>% c(<span>29</span>,<span>3</span>),<span>2</span>]=<span>'Endo'</span><br>  celltype[celltype$ClusterID %<span>in</span>% c(<span>2</span>,<span>8</span>),<span>2</span>]=<span>'fibo'</span><br><br>  <br>  head(celltype)<br>  celltype<br>  table(celltype$celltype)<br>  sce.all@meta.data$celltype = <span>"NA"</span><br>  <span>for</span>(i <span>in</span> <span>1</span>:nrow(celltype)){<br>    sce.all@meta.data[which(sce.all@meta.data$RNA_snn_res.0.3 == celltype$ClusterID[i]),<span>'celltype'</span>] &lt;- celltype$celltype[i]}<br>  table(sce.all@meta.data$celltype)<br><br> <span>library</span>(ggsci)<br>  color = c(pal_d3(<span>"category20"</span>)(<span>20</span>),<br>            pal_d3(<span>"category20b"</span>)(<span>20</span>),<br>            pal_d3(<span>"category20c"</span>)(<span>20</span>),<br>            pal_d3(<span>"category10"</span>)(<span>10</span>))<br>  <br>  DimPlot(sce.all, reduction = <span>"umap"</span>, group.by = <span>"celltype"</span>,<br>          cols = color,<br>          pt.size = <span>1.5</span>,<br>          label = <span>T</span>,label.box = <span>T</span><br>  ) <br>  ggsave(<span>'celltype-umap_2.pdf'</span>,height = <span>6</span>,width = <span>8</span>) <br><br>  <span>library</span>(stringr)  <br>  genes_to_check=str_to_upper(genes_to_check)<br>  genes_to_check<br>  th=theme(axis.text.x = element_text(angle = <span>45</span>, <br>                                      vjust = <span>0.5</span>, hjust=<span>0.5</span>))  <br>  p &lt;- DotPlot(sce.all, features = unique(genes_to_check) , assay=<span>'RNA'</span> ,group.by =                                     <span>'celltype'</span> )  + coord_flip()  +th<br>  p<br>  ggsave(plot=p, filename=<span>"check_marker_by_all.pdf"</span>,width = <span>10</span> ,height = <span>9</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.7202028740490279" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9IP02mdH9Jvxqp1zMx7ORDTGJvXQ9XR0M9FHIlUE9UVibUF0yCJqjtZYWia9wgsIBD6tZFeqIgMcow/640?wx_fmt=png" data-type="png" data-w="1183" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9IP02mdH9Jvxqp1zMx7ORDTGJvXQ9XR0M9FHIlUE9UVibUF0yCJqjtZYWia9wgsIBD6tZFeqIgMcow/640?wx_fmt=png"></figure><p data-tool="mdnice编辑器"><strong>step6: 根据10种实体癌症分组看细胞亚群分布</strong></p><pre data-tool="mdnice编辑器"><span></span><code><span># 1.加载R包 ----</span><br>rm(list=ls()) <br><span>library</span>(ggplot2) <br><span>library</span>(cowplot) <br><span>library</span>(paletteer)  <br><span>library</span>(gplots)<br><span>library</span>(ggpubr)    <br><span>library</span>(ggsci) <br><span>library</span>(stringr)<br><br><span># 2.设置工作路径 ----</span><br><span>#在meta信息中添加分组信息</span><br>getwd() <br>dir.create(<span>"../4_group"</span>)<br>setwd(<span>"../4_group/"</span>)<br>phe=sce.all@meta.data<br><span># 4.可视化 ----</span><br><span>## 4.1 每种细胞类型中，分组所占比例 ----</span><br><span>library</span>(tidyr)<span># 使用的gather &amp; spread</span><br><span>library</span>(reshape2) <span># 使用的函数 melt &amp; dcast </span><br><span>library</span>(dplyr)<br>tb=table(phe$celltype,<br>         phe$group)<br>head(tb)<br>balloonplot(tb)<br>bar_data &lt;- as.data.frame(tb)<br><br>bar_per &lt;- bar_data %&gt;% <br>  group_by(Var1) %&gt;%<br>  mutate(sum(Freq)) %&gt;%<br>  mutate(percent = Freq / `sum(Freq)`)<br>head(bar_per) <br>write.csv(bar_per,file = <span>"celltype_by_group_percent.csv"</span>)<br><span>library</span>(ggplot2)<br>ggplot(bar_per, aes(x = Var1, y = percent)) +<br>  geom_bar(aes(fill = Var2) , stat = <span>"identity"</span>) + coord_flip() +<br>  theme(axis.ticks = element_line(linetype = <span>"blank"</span>),<br>        legend.position = <span>"top"</span>,<br>        panel.grid.minor = element_line(colour = <span>NA</span>,linetype = <span>"blank"</span>), <br>        panel.background = element_rect(fill = <span>NA</span>),<br>        plot.background = element_rect(colour = <span>NA</span>)) +<br>  labs(y = <span>"% Relative cell source"</span>, fill = <span>NULL</span>)+labs(x = <span>NULL</span>)+<br>  scale_fill_d3()<br><span>#可视化</span><br>ggsave(<span>"celltype_by_group_percent.pdf"</span>,<br>       units = <span>"cm"</span>,width = <span>20</span>,height = <span>12</span>)<br></code></pre><figure data-tool="mdnice编辑器"><img data-ratio="0.6063618290258449" data-src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9IP02mdH9Jvxqp1zMx7ORDURtjnvdBZ3AfnjeNic27BYMDk1v2zRr0hQziamDbGLrw88XBnwFtvxicQ/640?wx_fmt=png" data-type="png" data-w="1006" src="https://mmbiz.qpic.cn/mmbiz_png/iaRJcrq2Los9IP02mdH9Jvxqp1zMx7ORDURtjnvdBZ3AfnjeNic27BYMDk1v2zRr0hQziamDbGLrw88XBnwFtvxicQ/640?wx_fmt=png"></figure><blockquote data-tool="mdnice编辑器"><p>我们可以从细胞分布图中看出与上皮癌细胞的组织类型特异性分布相比，无论恶性状态和组织类型，TME均无明显偏倚。</p><p>除此之外也可从对不同实体肿瘤进行tumor, normal 和 adjacent分组入手进行分析。</p><p>文章中提取成纤维细胞亚群进一步分析，感兴趣的可以去看看。<br></p></blockquote></section><p><br></p><p><mp-style-type data-value="3"></mp-style-type></p></div>  
<hr>
<a href="https://mp.weixin.qq.com/s/zgALlaJv444C1ksZDqJV8w",target="_blank" rel="noopener noreferrer">原文链接</a>
